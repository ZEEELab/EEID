{"version":3,"sources":["InfectiousMatter/MatterCollisionEvents.js","InfectiousMatter/location.js","InfectiousMatter/cohort.js","InfectiousMatter/event_queue.js","InfectiousMatter/pathogen.js","SimComponents/InfectiousMatterSimulation.js","InfectiousMatter/new_S.png","InfectiousMatter/simulation.js","InfectiousMatter/new_I.png","InfectiousMatter/new_R.png","SimComponents/InfectiousMatterContactGraph.js","SimComponents/InfectiousMatterPlot.js","SimComponents/InfectiousMatterContainer.js","index.js","InfectiousMatter/agent.js"],"names":["MatterCollisionEvents","name","version","for","install","matter","create","Body","body","apply","arguments","onCollide","cb","_mceOC","onCollideEnd","_mceOCE","onCollideActive","_mceOCA","after","Events","on","this","event","pairs","map","pair","trigger","bodyA","bodyB","require","Plugin","register","module","exports","uniqid","getRandomArbitrary","min","max","Math","random","Location","uuid","bounds","undefined","friction","occupants","border_color","prototype","draw_borders","ctx","strokeStyle","width","x","height","y","beginPath","rect","lineWidth","stroke","get_random_position","remove_agent","agent","filter","a","location","set_bounds","migrate_to","destination","callback","add_agent","try_getting_random_residents","num_to_get","arr","to_return","i","temp_a","floor","length","migrating","push","Cohort","members","move_cohort","callback_for_agent","send_cohort_home","home","cohorts","FastPriorityQueue","assert","EventQueue","fast_queue","b","time","add_event","cur_sim_time","q_event","original_time","add","run_events_fired","event_limit","num_events","peek","this_event","poll","stale","recurring","clear_events","_mutate_random","other_agent","new_color","color_float","jStat","exponential","sample","new_contagiousness","contagiousness","normal","Pathogen","color","parent","interaction_callback","mutation_function","get_offspring","mut_rate","new_pathogen","Matter","InfectiousMatterSimulation","InfectiousMatterRef","InfectiousMatterAPI","redraw_trigger","setWorldReadyTrigger","numMasked","popSize","sim_div","useRef","setup_world","num_to_mask","res1","type","payload","residence_props","residence","num_agents","Common","shuffle","current","agents","num_masked","useEffect","simulation_params","sim_time_per_day","agent_size","link_lifetime","console","log","InfectiousMatter","per_contact_infection","incubation_period_mu","incubation_period_sigma","infectious_period_mu","infectious_period_sigma","fraction_asymptomatic","asymptomatic_infectious_period_mu","asymptomatic_infectious_period_sigma","fraction_seek_care","fraction_isolate","time_to_seek_care","movement_scale","viva_colors","matter_colors","useLayoutEffect","c","ref","style","use","_seed","_random_fn","_Viva","ContactGraph","Graph","graph","Agent","colormap","pathogen_color_range","nshades","format","alpha","interpolate","AgentStates","SUSCEPTIBLE","INFECTED","RECOVERED","size","Engine","Render","World","Bodies","Mouse","Bounds","MouseConstraint","default_simulation_params","pathogen_mut_prob","default_infection_params","use_pathogen_contagiousness","default_simulation_colors","run_headless","infection_params","simulation_colors","extend","matter_world","headless","matter_engine","positionIterations","velocityIterations","constraintIterations","world","gravity","event_queue","migration_graph","setup_renderer","div_ref","_div","matter_render","element","engine","options","offsetHeight","offsetWidth","background","wireframes","mouse","canvas","mouseConstraint","constraint","stiffness","render","visible","removeEventListener","mousewheel","run","timelimit","t","choose","update","timing","timestamp","setup_matter_env","clear","locations","location_uuid_hash","state_counts","e","context","forEach","masked","draw_mask","pulse_orgs_event","update_org_state","org","new_state","old_state","agent_object","state","sprite","texture","SENSITIVE","new_iconS","add_location","location_properties","new_location","home_color","viva_node_color","add_cohort","new_cohort","assign_cohort","cohort","expose_org","eventual_infected_state","infecting_agent","pathogen","post_infection_callback","update_org_event","events","register_infection_callback","_check_edge_for_removal","edge","data","removeLink","calc_prob_infection","agent_a_body","agent_b_body","_default_interaction_callback","this_agent_body","this_edge","hasLink","hasNode","addLink","origin","home_location","agent_state","loc","colorIcon","new_agent_body","circle","xScale","yScale","plugin","wrap","setInertia","Infinity","frictionAir","restitution","node","addNode","something","viva_color","register_interaction_callback","get_prob_of_infection","handle_agent_contact","delete_agent","an_agent","Composite","remove","removeNode","q_item","set_agent_contact_callback","agent_contact_callback","clear_simulator","remove_simulator","stop","textures","temp_agent","applyForce","position","get_migration_links","forEachLink","link","from_uuid","fromId","to_uuid","toId","add_migration_link","from_location_uuid","to_location_uuid","num_agents_per_day","existing_edge","remove_migration_link","new_migration_event","source","dest","migrating_agent","home_state","velocity","setPosition","setVelocity","Viva","Layout","forceDirected","springLength","springCoeff","dragCoeff","View","webglGraphics","infection_layout","margin","l","r","pad","showlegend","legend","xanchor","xaxis","title","rangemode","yaxis","initial_traces","stackgroup","marker","reducer","action","cur_time","cur_state_counts","InfectiousMatterPlot","useReducer","plotTraces","dispatchTraces","useState","plotRevision","setPlotRevision","plot_layout","interval","setInterval","api_return","p","update_traces","clearInterval","layout","datarevision","useStyles","makeStyles","theme","root","flexGrow","minWidth","controlls","paper","textAlign","paperControlls","minHeight","padding","spacing","mask_transmission_props","self_protection","others_protection","default_infection_prob","random_res","new_agent","random_agent","agent_id","loc_idx","from_location","to_location","masked_list","unmasked_list","cur_num_masked","num_needing_masks","num_to_add","pop_size","InfectiousMatterContainer","props","classes","setPopSize","maskSelfProtection","maskOthersProtection","movementScale","setMovementScale","perContactInfection","setPerContactInfection","infectiousPeriodMean","setInfectiousPeriodMean","setRedrawTrigger","className","Grid","container","direction","justify","item","Card","Accordion","AccordionSummary","expandIcon","Typography","AccordionDetails","List","ListSubheader","disableSticky","ListItem","ListItemText","id","primary","Slider","value","valueLabelDisplay","onChange","newValue","step","Button","variant","onClick","ReactDOM","StrictMode","document","getElementById","track_all_contacts","add_body","fillStyle","fillRect","strokeRect"],"mappings":"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","file":"static/js/main.53fd5904.chunk.js","sourcesContent":["var Matter = require('matter-js');\nvar MatterCollisionEvents = {\n  name: 'matter-collision-events',\n  version: '0.1.5',\n  for: 'matter-js@^0.12.0',\n  install: function(matter) {\n    // add the onCollide, onCollideEnd, and onCollideActive callback handlers\n    // to the native Matter.Body created\n    var create = matter.Body.create;\n    matter.Body.create = function() {\n      var body = create.apply(null, arguments);\n      body.onCollide = function(cb) { body._mceOC = cb; }\n      body.onCollideEnd = function(cb) { body._mceOCE = cb; }\n      body.onCollideActive = function(cb) { body._mceOCA = cb; }\n      return body;\n    }\n    matter.after('Engine.create', function() {\n      matter.Events.on(this, 'collisionStart', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(pair.bodyA, 'onCollide', { pair : pair });\n          matter.Events.trigger(pair.bodyB, 'onCollide', { pair : pair });\n          pair.bodyA._mceOC &&\n            pair.bodyA._mceOC(pair)\n          pair.bodyB._mceOC &&\n            pair.bodyB._mceOC(pair)\n        });\n      });\n\n      matter.Events.on(this, 'collisionActive', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(\n            pair.bodyA,\n            'onCollideActive',\n            { pair: pair }\n          );\n          matter.Events.trigger(\n            pair.bodyB,\n            'onCollideActive',\n            { pair: pair }\n          );\n          pair.bodyA._mceOCA &&\n            pair.bodyA._mceOCA(pair)\n          pair.bodyB._mceOCA &&\n            pair.bodyB._mceOCA(pair)\n        });\n      });\n\n      matter.Events.on(this, 'collisionEnd', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(pair.bodyA, 'onCollideEnd', { pair : pair });\n          matter.Events.trigger(pair.bodyB, 'onCollideEnd', { pair : pair });\n          pair.bodyA._mceOCE &&\n            pair.bodyA._mceOCE(pair)\n          pair.bodyB._mceOCE &&\n            pair.bodyB._mceOCE(pair)\n        });\n      });\n    });\n  },\n};\n\nMatter.Plugin.register(MatterCollisionEvents);\nmodule.exports.MatterCollisionEvents = MatterCollisionEvents;\n","var uniqid = require(\"uniqid\");\n\nfunction getRandomArbitrary(min, max) {\n  return Math.random() * (max - min) + min;\n}\n\nfunction getRandomChoice(arr) {\n    return arr[Math.floor(arr.length * Math.random())];\n}\n\nfunction Location(name) {\n\tthis.name = name;\n\tthis.uuid = uniqid();\n\tthis.bounds = undefined;\n\tthis.friction = 0.2;\n\tthis.occupants = [];\n\tthis.border_color = undefined;\n}\n\nLocation.prototype.draw_borders = function(ctx, strokeStyle) {\n\tif (!strokeStyle || !this.border_color){\n\t\tstrokeStyle = \"black\";\n\t} else {\n\t\tstrokeStyle = strokeStyle || this.border_color;\n\t}\n\n\n\tlet width = this.bounds.max.x - this.bounds.min.x;\n\tlet height = this.bounds.max.y - this.bounds.min.y;\n\n\tctx.beginPath();\n\tctx.rect(this.bounds.min.x-2, this.bounds.min.y-2, width+4, height+4);\n\tctx.strokeStyle = strokeStyle;\n\tctx.lineWidth = 2;\n\tctx.stroke();\n};\n\nLocation.prototype.get_random_position = function() {\n\tif(this.bounds){\n\t\treturn {\n\t\t\tx: getRandomArbitrary(this.bounds.min.x, this.bounds.max.x),\n\t\t\ty: getRandomArbitrary(this.bounds.min.y, this.bounds.max.y)\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tx: 0, \n\t\t\ty: 0\n\t\t}\n\t}\n};\n\nLocation.prototype.remove_agent =function(agent) {\n\tthis.occupants = this.occupants.filter(function(a) {\n\t\treturn (a !== agent)\n\t});\n\tagent.location = undefined;\n};\n\nLocation.prototype.set_bounds = function(bounds) {\n\tthis.bounds = bounds;\n};\n\nLocation.prototype.migrate_to = function(destination, agent, callback) {\n\tthis.remove_agent(agent);\n\tdestination.add_agent(agent);\n\n\tif(callback) {\n\t\tcallback(agent);\n\t}\n};\n\nLocation.prototype.try_getting_random_residents = function(num_to_get) {\n\tlet to_return = [];\n\tfor (let i=0; i<num_to_get; i++) {\n\t\tlet temp_a = getRandomChoice(this.occupants);\n\t\tif(temp_a && temp_a.migrating == false) {\n\t\t\tto_return.push(temp_a);\n\t\t}\n\t}\n\n\treturn to_return;\n\n}\n\nLocation.prototype.add_agent = function(agent) {\n\tthis.occupants.push(agent);\n\tagent.location = this;\n};\n\nmodule.exports = Location;","function Cohort() {\n\tthis.members = [];\n}\n\nCohort.prototype.move_cohort = function(destination, callback_for_agent) {\n\tfor (let i=0; i < this.members.length; i++) {\n\t\tlet agent = this.members[i];\n\t\tagent.location.migrate_to(destination, agent, callback_for_agent);\n\t}\n};\n\nCohort.prototype.send_cohort_home = function(callback_for_agent) {\n\tfor (let i=0; i < this.members.length; i++) {\n\t\tlet agent = this.members[i];\n\t\tagent.location.migrate_to(agent.home, agent, callback_for_agent)\n\t}\n};\n\nCohort.prototype.add_agent = function(agent, callback) {\n\tthis.members.push(agent);\n\tagent.cohorts.push(this);\n\t\n\tif (callback) callback(agent);\n};\n\nmodule.exports = Cohort;","let FastPriorityQueue = require('fastpriorityqueue');\nlet assert = require('assert');\n\n\nfunction EventQueue() {\n\tthis.fast_queue = new FastPriorityQueue(function(a,b) {\n\t\treturn a.time < b.time;\n\t});\n}\n\nEventQueue.prototype.add_event = function(cur_sim_time, q_event) {\n\tassert(q_event.time && q_event.callback);\n\tq_event.original_time = q_event.time;\n\tq_event.time += cur_sim_time;\n\tthis.fast_queue.add(q_event);\n};\n\nEventQueue.prototype.run_events_fired = function(cur_sim_time, event_limit) {\n\tlet num_events = 0;\n\twhile (this.fast_queue.peek() && this.fast_queue.peek().time < cur_sim_time && num_events < event_limit){\n\t\tvar this_event = this.fast_queue.poll();\n\n\t\tif (this_event.stale == false) {\n\t\t\tif (this_event.recurring) {\n\t\t\t\tthis.add_event(cur_sim_time, {time:this_event.original_time, callback:this_event.callback, recurring:true, stale:false});\n\t\t\t}\n\t\t\tthis_event.callback();\n\t\t\tnum_events += 1;\n\t\t}\n\t}\n};\n\nEventQueue.prototype.clear_events = function() {\n\tthis.fast_queue = null;\n\tthis.fast_queue = new FastPriorityQueue(function(a,b) {\n\t\treturn a.time < b.time;\n\t});\n};\n\n\n\nmodule.exports = EventQueue;","import { jStat } from 'jstat';\n\nvar uniqid = require(\"uniqid\");\n\n\n\nlet _mutate_random = function(other_agent) {\n\tlet new_color = other_agent.color_float + jStat.exponential.sample(8);\n\tlet new_contagiousness = Math.min(other_agent.contagiousness + jStat.normal.sample(0, 0.1), 1);\n\n\tnew_color = new_color % 1;\n\t//new_color = Math.random();\n\n\tthis.color_float = new_color;\n\tthis.contagiousness = new_contagiousness;\n}\n\nfunction Pathogen(color, parent) {\n\tthis.parent = undefined;\n\tthis.interaction_callback = undefined;\n\tthis.uuid = uniqid()  ;\n\tthis.color_float = color || Math.random();\n\tthis.mutation_function = _mutate_random;\n\tthis.contagiousness = 0.5;\n}\n\nPathogen.prototype.get_offspring = function(mut_rate) {\n\tlet offspring_color = this.color_float;\n\tlet new_pathogen = new Pathogen(offspring_color);\n\n\tif (Math.random() < mut_rate && this.mutation_function) {\n\t\tnew_pathogen.mutation_function(this);\n\t}\n\treturn new_pathogen;\n};\n\nexport default Pathogen;\n","import React, { useEffect, useRef, useLayoutEffect } from 'react';\nimport { Typography } from '@material-ui/core';\nimport Button from '@material-ui/core/Button';\nimport {InfectiousMatter, AgentStates, ContactGraph} from '../InfectiousMatter/simulation.js';\nconst Matter = require('matter-js');\nconst Viva = require('vivagraphjs');\n\n\nconst InfectiousMatterSimulation = ({InfectiousMatterRef, InfectiousMatterAPI, redraw_trigger, setWorldReadyTrigger, numMasked, popSize}) => {\n    const sim_div = useRef(null);\n\n    const setup_world = (num_to_mask) => {\n        let res_prop = {\n            type: \"residence\", \n            friction: 0.01,\n            bounds: {\n                min: {\n                    x: 10,\n                    y: 10,\n                },\n                max: {\n                    x: 390,\n                    y: 390,\n                }\n            }\n        };\n\n        let res1 = InfectiousMatterAPI(InfectiousMatterRef, {type:'add_location', payload:{residence_props: res_prop}});\n        \n        //TODO: add popSize agents...\n        InfectiousMatterAPI(InfectiousMatterRef, {type:'add_agents', payload:{residence: res1, num_agents: popSize}});        \n        \n        //shuffle the agents\n        Matter.Common.shuffle(InfectiousMatterRef.current.agents);\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'set_num_mask', payload: {num_masked: num_to_mask}});\n    };\n\n    useEffect(() => {\n\n        let world_params = {\n            num_residences: 1,\n            residence_options: [],\n            pop_size: 20,\n            num_to_infect: 2,\n            num_visitors: 0,\n            residence_size: 100,\n            residence_padding: 20\n        \n        };\n        \n        let simulation_params = {\n            sim_time_per_day: 1000,\n            agent_size: 4,\n            link_lifetime: 200,\n        };\n        simulation_params.link_lifetime = 7*simulation_params.sim_time_per_day;\n        \n        var infection_params = {\n            per_contact_infection: 0.5, \n\n            incubation_period_mu: 5,\n            incubation_period_sigma: 3,\n            \n            infectious_period_mu: 7,\n            infectious_period_sigma: 4,\n            fraction_asymptomatic: 0.2,\n            \n            asymptomatic_infectious_period_mu: 1.5,\n            asymptomatic_infectious_period_sigma: 1.5,\n        \n            fraction_seek_care: 0.5,\n            fraction_isolate: 0.2,\n            time_to_seek_care: 2.5,\n            movement_scale: 2.0,\n        };\n  \n        let default_simulation_colors = {\n            viva_colors: [0xA9A9A9ff, 0x00FF00ff, 0xFFFF00ff, 0xFFA500ff, 0x0000FFff, 0xA9A9A9ff, 0xFF00FFff, 0x00CED1ff,0x98FB98ff, 0xCD853Fff],\n            matter_colors: [\"darkgrey\", \"lime\", \"yellow\", \"orange\", \"blue\", \"darkgrey\", \"fuchsia\", \"darkturquoise\", \"palegreen\", \"peru\"]\n        }\n\n        \n        console.log('initalizing matter')\n\n        InfectiousMatterRef.current = new InfectiousMatter(false, simulation_params, infection_params, default_simulation_colors);\n        InfectiousMatterAPI(InfectiousMatterRef, {type:'setup_environment', payload:{sim_div:sim_div}});\n\n        setup_world(numMasked);\n        //InfectiousMatterAPI(InfectiousMatterRef, {type:'reset_simulator'});\n        \n    }, [])\n\n    //redraw simulation if we get the triggers\n    useLayoutEffect(()=> { \n        if(InfectiousMatterRef.current) {\n            setup_world(numMasked);\n            setWorldReadyTrigger( c => c+1);\n        }\n    }, [redraw_trigger])\n\n    return (\n        <div>\n            <div ref={sim_div} style={{height:400, width:400}}>\n\n            </div>\n        </div>\n        \n    );\n\n};\n\nexport default InfectiousMatterSimulation;\nexport {AgentStates, ContactGraph};\n","export default \"data:image/png;base64,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\"","import { jStat } from 'jstat';\nimport Pathogen from './pathogen.js';\nimport InfectiousMatterSimulation from '../SimComponents/InfectiousMatterSimulation.js';\nimport new_iconS from './new_S.png'\nimport new_iconI from './new_I.png'\nimport new_iconR from './new_R.png'\n\n\nvar Matter = require('matter-js');\nrequire('matter-wrap');\nvar { MatterCollisionEvents } = require('./MatterCollisionEvents.js');\nMatter.use('matter-wrap', MatterCollisionEvents);\n\nMatter._seed = 2;\nMath.random = Matter.Common.random;\njStat._random_fn = Matter.Common.random;\n\nvar assert = require('assert');\n// module aliases\nlet _Viva = require('vivagraphjs');\nvar ContactGraph = new _Viva.Graph.graph();\n\nvar Location = require('./location.js');\nvar Cohort = require('./cohort.js');\nvar EventQueue = require('./event_queue.js');\n\nvar Agent = require('./agent.js');\n\nlet colormap = require('colormap')\nlet colors = colormap( {\n    colormap: 'chlorophyll',\n    nshades: 9,\n    format: 'hex',\n    alpha: 1\n});\n\nlet pathogen_colors = colormap({\n    colormap: 'portland',\n    nshades: 15,\n    format: 'hex',\n    alpha: 1\n})\n\nlet interpolate = require('color-interpolate');\nlet pathogen_color_range = interpolate(['white']);\n\nvar AgentStates = {\n    SUSCEPTIBLE: 0,\n    INFECTED: 1,\n    RECOVERED: 2,\n    size: 3\n};\n\nvar Engine = Matter.Engine;\nvar Render = Matter.Render;\nvar World = Matter.World;\nvar Body = Matter.Body;\nvar Bodies = Matter.Bodies;\nvar Bounds = Matter.Bounds;\nvar Mouse = Matter.Mouse;\nvar MouseConstraint = Matter.MouseConstraint;\nvar Events = Matter.Events;\n\n\nvar default_simulation_params = {\n    sim_time_per_day:2000,\n    agent_size: 3,\n    link_lifetime: 4000,\n    pathogen_mut_prob: 0.1\n};\n\nvar default_infection_params = {\n    per_contact_infection: 0.5, \n\n    incubation_period_mu: 5,\n    incubation_period_sigma: 3,\n    \n    infectious_period_mu: 7,\n    infectious_period_sigma: 4,\n    fraction_asymptomatic: 0.2,\n    \n    asymptomatic_infectious_period_mu: 1.5,\n    asymptomatic_infectious_period_sigma: 1.5,\n\n    fraction_seek_care: 0.5,\n    fraction_isolate: 0.2,\n    time_to_seek_care: 2.5,\n    movement_scale: 0.2,\n    use_pathogen_contagiousness: false\n};\n\nvar default_simulation_colors = {\n    viva_colors: [0x8B008Bff, 0x00FF00ff, 0xFFFF00ff, 0xFFA500ff, 0x0000FFff, 0xA9A9A9ff, 0xFF00FFff, 0x00CED1ff,0x98FB98ff, 0xCD853Fff],\n    matter_colors: [\"darkmagenta\", \"lime\", \"yellow\", \"orange\", \"blue\", \"darkgrey\", \"fuchsia\", \"darkturquoise\", \"palegreen\", \"peru\"]\n}\n\nfunction InfectiousMatter(run_headless, simulation_params, infection_params, simulation_colors) {   \n    this.simulation_params = Matter.Common.extend(default_simulation_params, simulation_params);\n    this.infection_params = Matter.Common.extend(default_infection_params, infection_params);\n    this.simulation_colors = Matter.Common.extend(default_simulation_colors, simulation_colors);\n    this.matter_world = World.create() \n    this.headless = run_headless || false;\n    this.pathogen_color_range = pathogen_color_range;    \n\n    console.log(\"creating infectious matter environment!\");\n\n    this.matter_engine = Engine.create({\n      positionIterations: 15, \n      velocityIterations: 15,\n      constraintIterations: 10\n    });\n\n    this.matter_engine.world.gravity.y = 0.00;\n    this.event_queue = new EventQueue();\n    this.migration_graph = new _Viva.Graph.graph()\n\n\n}\n\nInfectiousMatter.prototype.setup_renderer = function(div_ref) {\n    let _div = div_ref;\n\n    this.matter_render = Render.create({\n        element: _div,\n        engine: this.matter_engine,\n        options: {\n            height: _div.offsetHeight,\n            width: _div.offsetWidth,\n            background: 'rgba(229,229,229)',\n            wireframes: false\n        }\n    });\n\n    var mouse = Mouse.create(this.matter_render.canvas);\n    \n    this.mouseConstraint = MouseConstraint.create(this.matter_engine, {\n        mouse: mouse,\n        constraint: {\n            stiffness: 0.1,\n            render: {\n                visible: true\n            }\n        }\n    });\n    \n    mouse.element.removeEventListener(\"mousewheel\", mouse.mousewheel);\n    mouse.element.removeEventListener(\"DOMMouseScroll\", mouse.mousewheel);\n    this.matter_render.mouse = mouse;  \n    World.add(this.matter_engine.world, this.mouseConstraint);\n    \n    Render.run(this.matter_render);\n    Engine.run(this.matter_engine);\n}\n\nInfectiousMatter.prototype.run_headless = function(timelimit) {\n\ttimelimit = timelimit || 30;\n\n\tif(this.run_headless) {\n        for(let t=0; t<timelimit*this.simulation_params.sim_time_per_day; t++) {\n\t\t\t//console.log(\"updating \" + this.cur_sim_time);\n\t\t\t//console.log(this.state_counts);\n\t        this.event_queue.run_events_fired(this.cur_sim_time, 500);\n\n            let temp_agent = Matter.Common.choose(this.agents);\n\n            //console.log(temp_agent.body.position);\n\n            Engine.update(this.matter_engine, 1000 / 60);\n            this.cur_sim_time = this.matter_engine.timing.timestamp;\n        }\n\t}\n}\n\n\nInfectiousMatter.prototype.setup_matter_env = function() {\n    ContactGraph.clear();\n    this.locations = [];\n    \n    this.migration_graph.clear();\n    this.location_uuid_hash = {};\n\n    this.agents = [];\n    this.cohorts = [];\n    this.cur_sim_time = 0;\n    this.state_counts = [];\n    this.matter_engine.timing.timestamp = 0;\n\n    for (let i=0; i<AgentStates.size; i++){\n        this.state_counts.push(0);\n    }\n\n   \n    \n    //Engine.run(this.matter_engine);\n    //Render.run(this.matter_render);\n\n    if(!this.headless) {\n\t    Events.on(this.matter_render, \"beforeRender\", (e) => {\n\t        this.cur_sim_time = e.timestamp;\n\t        this.event_queue.run_events_fired(this.cur_sim_time, 500);\n\t    });\n\n\t    Events.on(this.matter_render, \"afterRender\", (e) => {\n\t        let ctx = this.matter_render.context;\n\t        \n\t        if(ctx) {\n\t            //todo: refactor to callback\n\t            for (let i=0; i< this.locations.length; i++) {\n\t                this.locations[i].draw_borders(ctx);\n                } \n                this.agents.forEach( (agent) => {\n                    if(agent.masked){\n                        agent.draw_mask(ctx, this.simulation_params.agent_size);\n                    }\n                });\n\t        }\n\t    });\n    }\n\n    this.add_event({time: 100, callback: this.pulse_orgs_event(), recurring:true, stale:false})\n\n};\n\nInfectiousMatter.prototype.update_org_state = function(org, new_state) {\n    let old_state = org.agent_object.state;\n    org.agent_object.state = new_state;\n\n    if( typeof old_state !== 'undefined') this.state_counts[old_state] -= 1;\n    \n    this.state_counts[new_state] += 1;\n\n    org.render.lineWidth = 3;\n    let stroke_color = org.render.strokeStyle;\n    let viva_node_color;\n\n    //todo: refactor to callback?\n    //refactor to event!\n    switch(new_state) {\n        case AgentStates.INFECTED:\n            viva_node_color = 0xFF0000ff;\n            org.render.sprite.texture = new_iconI;\n            break;\n        case AgentStates.RECOVERED:\n            viva_node_color = 0xFFFFFFff;\n            org.render.sprite.texture = new_iconR;\n\n            break;\n        case AgentStates.SENSITIVE:\n            org.render.lineWidth = 0;\n            org.render.sprite.texture = new_iconS;\n            break;\n        };\n\n    return org;\n    //viva_graphics.getNodeUI(org.agent_object.node.id).color = viva_node_color;\n};\n\nInfectiousMatter.prototype.add_location = function(name, location_properties) {\n    let new_location = new Location(name);\n    new_location.border_color = location_properties.border_color;\n    new_location.set_bounds(location_properties.bounds);\n    new_location.friction = location_properties.friction;\n    new_location.type = location_properties.type || 'none';\n\n    new_location.home_color = this.simulation_colors.matter_colors[this.locations.length];\n    new_location.viva_node_color = this.simulation_colors.viva_colors[this.locations.length];\n\n    this.locations.push(new_location);\n    this.location_uuid_hash[new_location.uuid] = new_location;\n    return new_location;\n};\n\nInfectiousMatter.prototype.add_cohort = function() {\n    let new_cohort = new Cohort();\n    this.cohorts.push(new_cohort);\n    return new_cohort;\n};\n\nInfectiousMatter.prototype.assign_cohort = function(org, cohort) {\n    cohort.add_agent(org.agent_object);\n};\n\nInfectiousMatter.prototype.expose_org = function(org, eventual_infected_state, infecting_agent) {\n    if (infecting_agent && infecting_agent.pathogen){ \n        org.agent_object.pathogen = infecting_agent.pathogen.get_offspring(this.simulation_params.pathogen_mut_prob);\n    } else {\n        org.agent_object.pathogen = new Pathogen(0.5, 'root');\n    }\n\n    this.update_org_state(org, AgentStates.INFECTED);\n    if (this.post_infection_callback) this.post_infection_callback(org.agent_object, infecting_agent);\n\n    let days_to_recover = Math.max(jStat.exponential.sample(1/this.infection_params.infectious_period_mu), 3);\n\n    let update_org_event = {\n        time: days_to_recover*this.simulation_params.sim_time_per_day,\n        callback: () => {\n            this.update_org_state(org, AgentStates.RECOVERED);\n        },\n        stale: false\n    }\n    this.add_event(update_org_event);\n    org.agent_object.events.push(update_org_event)\n};\n\nInfectiousMatter.prototype.register_infection_callback = function(callback) {\n    this.post_infection_callback = callback;\n}\n\nInfectiousMatter.prototype._check_edge_for_removal = function(edge) {\n    return () => {\n        if (edge.data.timestamp < this.cur_sim_time - this.simulation_params.link_lifetime) {\n            ContactGraph.removeLink(edge);\n        } \n        else {\n            this.add_event( {\n                time:(this.cur_sim_time + this.simulation_params.link_lifetime) - edge.data.timestamp,\n                callback: this._check_edge_for_removal(edge),\n                stale: false\n            }); \n        }\n    };\n};\n\nInfectiousMatter.prototype.calc_prob_infection = function(agent_a_body, agent_b_body) {\n    return this.infection_params.per_contact_infection;\n}\n\nInfectiousMatter.prototype._default_interaction_callback  = function(this_agent_body) {\n    return (\n        (other_agent) => {\n            if (other_agent.state == AgentStates.INFECTED && \n                this_agent_body.agent_object.state == AgentStates.SUSCEPTIBLE) {\n\n                if (Matter.Common.random(0, 1) < this.calc_prob_infection(this_agent_body, other_agent.body)) {\n                    this.expose_org(this_agent_body, AgentStates.INFECTED, other_agent);\n                    //this.`post_infection_callback`(this_agent.agent_object, other_agent);\n                }\n            }\n\n            assert(other_agent.uuid && this_agent_body.agent_object.uuid)\n\n            var this_edge = ContactGraph.hasLink(this_agent_body.agent_object.uuid, other_agent.uuid) || ContactGraph.hasLink(other_agent.uuid, this_agent_body.agent_object.uuid);\n            if (this_edge){\n                this_edge.data.timestamp = this.cur_sim_time;\n            } else {\n                assert(ContactGraph.hasNode(this_agent_body.agent_object.uuid) && ContactGraph.hasNode(this_agent_body.agent_object.uuid));\n                this_edge = ContactGraph.addLink(this_agent_body.agent_object.uuid, other_agent.uuid, {origin:this_agent_body.agent_object.uuid, timestamp:this.cur_sim_time});\n                this.add_event( {\n                    time: this.simulation_params.link_lifetime+1, \n                    callback: this._check_edge_for_removal(this_edge),\n                    stale: false\n                });\n            }\n\n        }\n    );\n};\n\nInfectiousMatter.prototype.add_agent = function(home_location, agent_state=AgentStates.SUSCEPTIBLE) {\n\n    assert(home_location && home_location.get_random_position);\n\n    let loc = home_location.get_random_position();\n    //let new_agent_body = \n    let colorIcon= new_iconS\n\n    let new_agent_body = Bodies.circle(loc.x, loc.y, this.simulation_params.agent_size, {\n        render: {sprite: {texture: colorIcon, xScale: 0.15,\n        yScale: 0.15}},\n        plugin: {wrap: home_location.bounds}, \n        \n    });\n\n    Matter.Body.setInertia(new_agent_body, Infinity);\n\n    new_agent_body.agent_object = new Agent(new_agent_body);\n    new_agent_body.frictionAir = home_location.friction;\n    new_agent_body.friction = 0;\n    new_agent_body.restitution = 1.1;\n    new_agent_body.node = ContactGraph.addNode(new_agent_body.agent_object.uuid, {something:true});\n    new_agent_body.agent_object.home = home_location;\n    new_agent_body.agent_object.viva_color = home_location.viva_node_color\n\n    \n    home_location.add_agent(new_agent_body.agent_object);\n\n    new_agent_body.agent_object.register_interaction_callback(this._default_interaction_callback(new_agent_body, this.get_prob_of_infection));\n\n\n    new_agent_body.onCollide( (pair) => {\n        if (pair.bodyA === new_agent_body && pair.bodyB.agent_object) {\n            pair.bodyA.agent_object.handle_agent_contact(pair.bodyB.agent_object);\n\n        } else if (pair.bodyB === new_agent_body && pair.bodyA.agent_object) {\n            pair.bodyB.agent_object.handle_agent_contact(pair.bodyA.agent_object)\n        }\n    });\n\n    World.add(this.matter_engine.world, new_agent_body);\n    this.agents.push(new_agent_body.agent_object);\n    this.update_org_state(new_agent_body, agent_state);\n    \n    return(new_agent_body);\n};\n\nInfectiousMatter.prototype.delete_agent = function(an_agent) {\n\n    this.agents = this.agents.filter(function(a) {\n\t\treturn (a !== an_agent)\n    });\n\n    Matter.Composite.remove(this.matter_engine.world, an_agent.body);\n    ContactGraph.removeNode(an_agent.uuid);\n\n    this.state_counts[an_agent.state] -= 1;\n    //TODO: Clear events associated with this agent?\n    an_agent.events.forEach((event) => {event.stale = true;})\n}\n\nInfectiousMatter.prototype.add_event = function (q_item) {\n    assert(q_item.time && q_item.callback);\n    this.event_queue.add_event(this.cur_sim_time, q_item);\n};\n\nInfectiousMatter.prototype.set_agent_contact_callback = function (callback) {\n    this.agent_contact_callback = callback;\n};\n\nInfectiousMatter.prototype.clear_simulator = function() {\n    //Render.stop(this.matter_render);\n    World.clear(this.matter_engine.world);\n    Engine.clear(this.matter_engine);\n    this.event_queue.clear_events();\n}\n\nInfectiousMatter.prototype.remove_simulator = function() {\n    this.clear_simulator();\n    Render.stop();\n\n    this.matter_engine.events = {};\n    this.matter_render.canvas.remove();\n    this.matter_render.canvas = null;\n    this.matter_render.context = null;\n    this.matter_render.textures = {};\n\n    this.matter_world = null;\n    this.matter_engine = null;\n    this.event_queue = null;\n    this.matter_render = null;\n    this.mouseConstraint = null;\n}\n\nInfectiousMatter.prototype.pulse_orgs_event = function() {\n    return () => {\n        if (this.agents.length > 0) {\n            for (let i=0; i < 100; i++) {\n                let temp_agent = Matter.Common.choose(this.agents);\n                Matter.Body.applyForce(temp_agent.body, temp_agent.body.position, {\n                    x:Matter.Common.random(-2e-5*this.infection_params.movement_scale, 2e-5*this.infection_params.movement_scale),\n                    y:Matter.Common.random(-2e-5*this.infection_params.movement_scale, 2e-5*this.infection_params.movement_scale)\n                });\n            }\n        }\n    };\n};\n\nInfectiousMatter.prototype.get_migration_links = function() {\n    let to_return = []\n    this.migration_graph.forEachLink(function(link) {\n        to_return.push({from_uuid:link.fromId, to_uuid:link.toId, num_agents:link.data.num_agents});\n    });\n    return to_return;\n}\nInfectiousMatter.prototype.add_migration_link = function(from_location_uuid, to_location_uuid, num_agents_per_day) {\n    var existing_edge = this.migration_graph.hasLink(from_location_uuid, to_location_uuid);\n    if(existing_edge) {\n        existing_edge.data.num_agents = num_agents_per_day;\n    } else {\n        this.migration_graph.addLink(from_location_uuid, to_location_uuid, {num_agents:num_agents_per_day});\n    }\n};\nInfectiousMatter.prototype.remove_migration_link = function(from_location_uuid, to_location_uuid) {\n    var existing_edge = this.migration_graph.hasLink(from_location_uuid, to_location_uuid);\n    if (existing_edge) {\n        this.migration_graph.removeLink(existing_edge);\n    }\n};\n\n\nInfectiousMatter.prototype.new_migration_event = function() {\n    return () => {\n        this.migration_graph.forEachLink((link) => {\n            let source = this.location_uuid_hash[link.fromId];\n            let dest = this.location_uuid_hash[link.toId];\n\n            let to_migrate = source.try_getting_random_residents(link.data.num_agents);\n            to_migrate.forEach( migrating_agent => {\n                migrating_agent.home_state = {\n                    location:source, \n                    position: {...migrating_agent.body.position}, \n                    velocity: {...migrating_agent.body.velocity}\n                };\n\n                source.migrate_to(dest, migrating_agent, function(agent) {\n                    agent.body.plugin.wrap = dest.bounds;\n                    Matter.Body.setPosition(agent.body, dest.get_random_position());\n                    agent.body.frictionAir = dest.friction;\n                    agent.migrating = true;\n                });\n\n                this.add_event( {\n                    time: this.simulation_params.sim_time_per_day,\n                    callback: () => {\n                        dest.migrate_to(source, migrating_agent, (agent) => {\n                            Matter.Body.setPosition(agent.body, migrating_agent.home_state.position);\n                            agent.body.plugin.wrap = source.bounds;\n                            Matter.Body.setVelocity(agent.body, migrating_agent.home_state.velocity);\n                            agent.body.frictionAir = source.friction;\n                            agent.migrating = false;\n                        })\n                    }\n                })\n            } )\n\n            //TODO: check if this link still makes sense, if not we should remove it...\n        })\n    }\n};\n\nexport { InfectiousMatter, AgentStates, ContactGraph };\n","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,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\"","import React, {useEffect, useState, useReducer, useRef, useLayoutEffect} from 'react';\nimport {AgentStates, ContactGraph} from '../InfectiousMatter/simulation.js';\nimport Agent from '../InfectiousMatter/agent.js';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Viva from 'vivagraphjs';\n\nlet viva_layout = Viva.Graph.Layout.forceDirected(ContactGraph, {\n    springLength : 15,\n    springCoeff : 0.00005,\n    dragCoeff : 0.01,\n    gravity : -1.5\n});\n\nlet viva_graphics = Viva.Graph.View.webglGraphics();\n\n\nconst InfectiousMatterContactGraph = ({InfectiousMatterRef, InfectiousMatterAPI, worldReadyTrigger}) => {\n    const graph_div = useRef(null);\n\n    useEffect( ()=> {\n        console.log(\"initalizing viva graph\");\n        let viva_renderer = Viva.Graph.View.renderer(ContactGraph, {\n            container: graph_div.current,\n            graphics: viva_graphics,\n            renderLinks: true,\n            layout: viva_layout,\n            interactive: 'node drag'\n    \n        });\n        viva_renderer.run();\n        for (let i=0; i < 30; i++) {\n            viva_renderer.zoomOut();\n        }\n    }, []);\n\n    useEffect ( () => {\n        const color_agent = (agent) => {\n            viva_graphics.getNodeUI(agent.uuid).color = agent.viva_color;\n            viva_graphics.getNodeUI(agent.uuid).size = 40;\n        }\n\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'forEach_agents', payload:{callback:color_agent}})\n    }, [worldReadyTrigger])\n\n    return (\n        <div ref={graph_div} style={{width:400, height:400}} >\n        </div>\n    );\n};\n\nexport default InfectiousMatterContactGraph;\n","import React, {useEffect, useState, useReducer, useLayoutEffect} from 'react';\nimport Plot from 'react-plotly.js'; //TODO: use bundles to limit the size of this app\nimport {AgentStates} from '../InfectiousMatter/simulation.js';\n\nlet get_fresh_traces = function() {\n  let susceptible = {\n    x: [0],\n    y: [0],\n    stackgroup: 'one',\n    name: \"Susceptible\",\n    type: \"scattergl\",\n    marker: { color: \"grey\" }\n  }\n\n  let infected = {\n    x: [0],\n    y: [0],\n    stackgroup: 'one',\n    type: \"scattergl\",\n    name: \"Infected\",\n    marker: { color: \"red\" }\n  };\n\n  let recovered = {\n    x: [0],\n    y: [0],\n    stackgroup: 'one',\n    name: \"Recovered\",\n    type: \"scattergl\",\n    marker: { color: \"blue\" }\n  };\n\n  let plot_data = [infected, recovered, susceptible];\n  return plot_data;\n}\n\nlet infection_layout = {\n  margin: {\n      l: 50,\n      r: 10,\n      b: 50,\n      t: 10,\n      pad: 10\n    },\n  showlegend: true,\n  legend: {\n      x:1,\n      xanchor: 'right',\n      y:1\n  }, \n  xaxis: {\n      title: \"Days\",\n      rangemode: 'nonnegative'\n  }, \n  yaxis: {\n      title: \"Count\",\n      rangemode: 'nonnegative'\n  },\n  width:390,\n  height:390\n};\n\nconst initial_traces = get_fresh_traces();\n\nfunction reducer(state, action) {\n  if (!state) { console.log('didnt get state');}\n  let new_state = [...state];\n  switch (action.type) {\n    case 'extend': {\n      new_state[0].x.push(action.payload.cur_time);\n      new_state[0].y.push(action.payload.cur_state_counts[AgentStates.INFECTED]);\n\n      new_state[1].x.push(action.payload.cur_time);\n      new_state[1].y.push(action.payload.cur_state_counts[AgentStates.RECOVERED]);\n\n      new_state[2].x.push(action.payload.cur_time);\n      new_state[2].y.push(action.payload.cur_state_counts[AgentStates.SUSCEPTIBLE]);\n\n\n      // new_state[1].push(action.payload.state_counts[AgentStates.S_INFECTED] + action.state_counts[AgentStates.A_INFECTED]);\n      // new_state[2].push(action.payload.state_counts[AgentStates.RECOVERED]);\n      // new_state[3].push(action.payload.state_counts[AgentStates.SUSCEPTIBLE]);\n      return new_state;\n    }\n    case 'reset': {\n        new_state = get_fresh_traces();\n        return new_state;\n    }\n    default: {\n\n    }\n  }\n}\n\nconst InfectiousMatterPlot = ({InfectiousMatterRef, InfectiousMatterAPI, redraw_trigger}) => {\n\n  const [plotTraces, dispatchTraces] = useReducer(reducer, initial_traces);\n  const [plotRevision, setPlotRevision] = useState(0);\n  let plot_data = get_fresh_traces();\n  let plot_layout = infection_layout;\n\n  useEffect( () => {\n    const update_traces = () => {\n        let api_return = InfectiousMatterAPI(InfectiousMatterRef, {type:'get_state_counts'});\n        dispatchTraces({type: 'extend', payload:{cur_time: api_return.cur_time, cur_state_counts: api_return.state_counts}});\n        setPlotRevision(p => p+1);\n      };\n\n    const interval = setInterval( ()=> {\n      update_traces();\n    }, 600);\n    return () => { clearInterval(interval);};\n  }, [redraw_trigger])\n\n  //redraw plot if we get the triggers\n  useLayoutEffect(()=> { \n    if(InfectiousMatterRef.current) {\n        dispatchTraces({type:'reset'});\n        setPlotRevision(p => p+1);\n    }\n  }, [redraw_trigger])\n\n  return (\n    <Plot\n      data={plotTraces}\n      layout={{...plot_layout, datarevision:plotRevision}}\n    />\n  );\n};\n\nexport default InfectiousMatterPlot;\n","import React, {useRef, useEffect, useReducer, useState, useLayoutEffect} from 'react';\nimport Button from '@material-ui/core/Button';\nimport { Accordion } from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { AccordionSummary } from '@material-ui/core';\nimport { AccordionDetails } from '@material-ui/core';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport Typography from '@material-ui/core/Typography';\nimport { InfectiousMatter} from '../InfectiousMatter/simulation.js';\nimport InfectiousMatterSimulation, {AgentStates, ContactGraph} from './InfectiousMatterSimulation.js';\nimport InfectiousMatterContactGraph from './InfectiousMatterContactGraph.js';\nimport InfectiousMatterPlot from './InfectiousMatterPlot.js';\nimport Matter from 'matter-js';\nimport Slider from '@material-ui/core/Slider';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListSubheader from '@material-ui/core/ListSubheader';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 0,\n    minWidth:1000\n  },\n  controlls: {\n    width:400,\n  },\n  paper: {\n    height: 400,\n    width: 400,\n    textAlign: 'center',\n  },\n  paperControlls: {\n    minHeight: 400,\n    minWidth: 400,\n    textAlign: 'center',\n    padding: theme.spacing(1)\n  }\n}));\n\nInfectiousMatter.prototype.mask_transmission_props = { self_protection:0.05, others_protection:0.5};\n\n//agent_a is always a susceptable exposed to an infected (agent_b)\nInfectiousMatter.prototype.calc_prob_infection = function(agent_a_body, agent_b_body) {\n  let default_infection_prob = this.infection_params.per_contact_infection;\n  if(agent_a_body.agent_object.masked && agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.self_protection) * (1-this.mask_transmission_props.others_protection);\n  else if (agent_a_body.agent_object.masked &&! agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.self_protection);\n  else if (!agent_a_body.agent_object.masked && agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.others_protection);\n  else if (!agent_a_body.agent_object.masked &&! agent_b_body.agent_object.masked)\n      return default_infection_prob;\n}\n\nconst InfectiousMatterAPI = (InfectiousMatterRef, action) => {\n  if (action.type == 'setup_environment') {\n    InfectiousMatterRef.current.setup_renderer(action.payload.sim_div.current);\n    InfectiousMatterRef.current.setup_matter_env();\n  }\n  if (action.type == 'update_infection_params') {\n    if(action.payload.per_contact_infection) {\n      InfectiousMatterRef.current.infection_params.per_contact_infection = action.payload.per_contact_infection;\n    }\n    if(action.payload.infectious_period_mu) {\n      InfectiousMatterRef.current.infection_params.infectious_period_mu = action.payload.infectious_period_mu;\n    }\n  };\n  if (action.type == 'update_mask_transmission_params') {\n    if(action.payload.self_protection) {\n      InfectiousMatterRef.current.mask_transmission_props.self_protection = action.payload.self_protection;\n    }\n    if(action.payload.others_protection) {\n      InfectiousMatterRef.current.mask_transmission_props.others_protection = action.payload.others_protection;\n    }\n  }\n  if (action.type == 'update_movement_scale') {\n    if(action.payload.movement_scale) {\n      InfectiousMatterRef.current.infection_params.movement_scale = action.payload.movement_scale;\n    }\n  }\n  if (action.type == 'reset_simulator') {\n    InfectiousMatterRef.current.clear_simulator();\n    InfectiousMatterRef.current.setup_matter_env();\n  }\n  if (action.type == 'add_location') {\n    let res = InfectiousMatterRef.current.add_location('residence', action.payload.residence_props)\n    return res;\n  }\n  if (action.type == 'add_random_agent') {\n    let random_res = Matter.Common.choose(InfectiousMatterRef.current.locations);\n    let new_agent = InfectiousMatterRef.current.add_agent(random_res);\n\n    if (action.payload && action.payload.callback && new_agent) {\n      action.payload.callback(new_agent.agent_object); \n    }\n  }\n\n  if (action.type == 'remove_random_agent') {\n    let random_agent = Matter.Common.choose(InfectiousMatterRef.current.agents);\n    InfectiousMatterRef.current.delete_agent(random_agent);\n  }\n  if (action.type == 'add_agents') {\n    let new_agent = null;\n    if (action.payload.residence && action.payload.num_agents) {\n      for (let i=0; i< action.payload.num_agents; i++) {\n        new_agent = InfectiousMatterRef.current.add_agent(action.payload.residence)\n      }\n    }\n    if (action.payload.callback && new_agent) {\n      action.payload.callback(new_agent.agent_object); \n    }\n  }\n  if (action.type == 'map_agents') {\n    return InfectiousMatterRef.current.agents.map( (agent, agent_id) => action.payload.callback(agent, agent_id));\n  }\n  if (action.type == 'forEach_agents') {\n    InfectiousMatterRef.current.agents.forEach( (agent) => action.payload.callback(agent));\n  }\n  if (action.type == 'map_locations') {\n    return InfectiousMatterRef.current.locations.map( (loc, loc_idx) => action.payload.callback(loc, loc_idx));\n  }\n  if (action.type == 'forEach_location') {\n    InfectiousMatterRef.current.locations.forEach( (loc) => action.payload.callback(loc));\n  }\n  if (action.type == 'infect_random_agents') {\n    if(action.payload.num_agents) {\n      for(let i=0; i< action.payload.num_agents; i++) {\n        let random_agent = Matter.Common.choose(InfectiousMatterRef.current.agents);\n        InfectiousMatterRef.current.expose_org(random_agent.body, AgentStates.INFECTED);\n      }\n    }\n  } \n  if (action.type == 'get_migration_links') {\n    return InfectiousMatterRef.current.get_migration_links();\n  }\n  if (action.type == 'add_migration_link') {\n    InfectiousMatterRef.current.add_migration_link(action.payload.from_location, action.payload.to_location, action.payload.num_agents)\n  }\n  if (action.type == 'clear_migration_links') {\n    InfectiousMatterRef.current.migration_graph.clear();\n  }\n  if (action.type == 'remove_migration_link') {\n    InfectiousMatterRef.current.remove_migration_link(action.payload.from_location, action.payload.to_location)\n  }\n  if (action.type == 'get_state_counts') {\n    return {state_counts: InfectiousMatterRef.current.state_counts, cur_time: InfectiousMatterRef.current.cur_sim_time/ InfectiousMatterRef.current.simulation_params.sim_time_per_day};\n  }\n  if (action.type == 'set_num_mask') {\n    // get current num of people masked\n    let masked_list=[];\n    let unmasked_list=[];\n    InfectiousMatterRef.current.agents.forEach( (agent) => {\n      if(agent.masked){\n        masked_list.push(agent);\n      }\n      else{\n        unmasked_list.push(agent);\n      }\n    });\n\n    let cur_num_masked = masked_list.length;\n    let num_needing_masks = action.payload.num_masked - cur_num_masked;\n    if (num_needing_masks > 0) {\n      for(let i=0; i< num_needing_masks; i++) {\n        unmasked_list[i].masked = true;\n      }\n    } else if (num_needing_masks < 0) {\n      for(let i=0; i<-num_needing_masks; i++) {\n        masked_list[i].masked = false;\n      }\n    }\n  }\n\n  if (action.type == \"set_pop_size\") {\n    //target pop size - current pop size:\n    let num_to_add = action.payload.pop_size - InfectiousMatterRef.current.agents.length;\n\n    if (num_to_add > 0) {\n      for(let i=0; i< num_to_add; i++) {\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'add_random_agent'});\n      }\n    } else if (num_to_add < 0) {\n      for(let i=0; i< -num_to_add; i++) {\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'remove_random_agent'});\n      }\n    }\n\n  };\n};\n\n\n\nconst InfectiousMatterContainer = (props) => {\n  const classes = useStyles();\n  const InfectiousMatterRef = useRef(null);\n  const [numMasked, setNumMasked] = useState(0);\n  const [popSize, setPopSize] = useState(350);\n  const [maskSelfProtection, setMaskSelfProtection] = useState(0.05);\n  const [maskOthersProtection, setMaskOthersProtection] = useState(0.5);\n  const [movementScale, setMovementScale] = useState(2.0);\n   \n  const [perContactInfection, setPerContactInfection] = useState(0.5);\n  const [infectiousPeriodMean, setInfectiousPeriodMean] = useState(5);\n\n  const [redraw_trigger, setRedrawTrigger] = useState(0);\n  const [worldReadyTrigger, setWorldReadyTrigger] = useState(0);\n\n  const resetSimulation = (e) => {\n    InfectiousMatterAPI(InfectiousMatterRef, {type: 'reset_simulator'});\n    setRedrawTrigger(c=>c+1);\n  }\n  const infectAgent = (e) => {\n    InfectiousMatterAPI(\n      InfectiousMatterRef, \n      {\n        type: 'infect_random_agents', \n        payload: {\n          num_agents: 1\n        }\n      });\n  }\n\n  function handlePerContactInfectionChange(event, newValue) {\n    setPerContactInfection(newValue);\n  }\n\n  function handleInfectiousPeriodMean(event, newValue) {\n    setInfectiousPeriodMean(newValue);\n  }\n\n  function handlePopSizeSliderChange(event, newValue){\n    setPopSize(newValue);\n  }\n  function handleMaskSelfProtectionChange(event, newValue) {\n    setMaskSelfProtection(newValue);\n  }\n  function handleMaskOthersProtectionChange(event, newValue) {\n    setMaskOthersProtection(newValue);\n  }\n  function handleMovementScaleChange(event, newValue) {\n    setMovementScale(newValue);\n  }\n  \n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_infection_params', payload: {per_contact_infection: perContactInfection}});\n  }, [perContactInfection])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_infection_params', payload: {infectious_period_mu: infectiousPeriodMean}});\n  }, [infectiousPeriodMean])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_mask_transmission_params', payload: {self_protection: maskSelfProtection}});\n  }, [maskSelfProtection])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_mask_transmission_params', payload: {others_protection: maskOthersProtection}});\n  }, [maskOthersProtection])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_movement_scale', payload: {movement_scale: movementScale}});\n  }, [movementScale])\n\n  useEffect( () => {\n    InfectiousMatterAPI(InfectiousMatterRef, {type: 'set_num_mask', payload: {num_masked: numMasked}});\n  }, [numMasked]);\n\n  useEffect( () => {\n    InfectiousMatterAPI(InfectiousMatterRef, {type: 'set_pop_size', payload: {pop_size: popSize}});\n    setWorldReadyTrigger(c => c+1);\n  }, [popSize]);\n\n  return (\n    <div className=\"App\">\n      <Grid container direction=\"row\" justify=\"center\" className={classes.root} spacing={3}>\n        <Grid item>\n          <Card className={classes.paper}>\n          <InfectiousMatterPlot                 \n            InfectiousMatterRef={InfectiousMatterRef}\n            InfectiousMatterAPI={InfectiousMatterAPI}\n            redraw_trigger={redraw_trigger}\n          />\n          </Card>\n        </Grid>\n        <Grid item>\n        <Card className={classes.paper}>\n          <InfectiousMatterSimulation \n            InfectiousMatterRef={InfectiousMatterRef}\n            InfectiousMatterAPI={InfectiousMatterAPI}\n            redraw_trigger={redraw_trigger}\n            setWorldReadyTrigger={setWorldReadyTrigger}\n            numMasked={numMasked}\n            popSize={popSize}\n          />\n        </Card>\n        </Grid>\n\n        {/*\n        <Grid item>\n          <Card className={classes.paper}>\n            <InfectiousMatterContactGraph                 \n              InfectiousMatterRef={InfectiousMatterRef}\n              InfectiousMatterAPI={InfectiousMatterAPI} \n              worldReadyTrigger={worldReadyTrigger}\n            />\n          </Card>\n        </Grid>\n        */}\n\n      </Grid>\n      \n      <Grid container direction=\"row\" justify=\"center\" className={classes.root} spacing={2}>\n        <Grid item>\n        <Accordion spacing={2}>\n          <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n            <Typography>Controlls</Typography>\n          </AccordionSummary>\n          <AccordionDetails>\n          <List>\n          <ListSubheader disableSticky={true}>World Settings</ListSubheader>\n          <ListItem>\n            <ListItemText id=\"PopSize\" primary=\"Pop Size\" />\n              <Slider\n                value={popSize}\n                aria-labelledby=\"discrete-slider\"\n                valueLabelDisplay=\"auto\"\n                onChange={handlePopSizeSliderChange}\n                step={1}\n                min={0}\n                max={800}\n              />\n          </ListItem>\n          <ListItem>\n            <ListItemText id=\"Movement\" primary=\"Movement Scale\" />\n            <Slider\n              value={movementScale}\n              aria-labelledby=\"discrete-slider\"\n              valueLabelDisplay=\"auto\"\n              onChange={handleMovementScaleChange}\n              step={0.25}\n              min={0}\n              max={10}\n            />\n          </ListItem>\n          <ListItem>\n            <Grid container direction=\"row\" spacing={3}>\n              <Grid item>\n                <Button variant=\"contained\" size=\"small\" onClick={resetSimulation}>Reset</Button>\n              </Grid>\n              <Grid item>\n                <Button variant=\"contained\" size=\"small\" onClick={infectAgent}>\n                  Infect Random Agent\n                </Button>\n              </Grid>\n            </Grid>\n          </ListItem>          \n\n          \n          <ListSubheader disableSticky={true}>Infection Settings</ListSubheader>\n          <ListItem>\n            <ListItemText id=\"infectionRate\" primary=\"Prob. Infection\"/>\n              <Slider\n                value={perContactInfection}\n                aria-labelledby=\"continuous-slider\"\n                onChange={handlePerContactInfectionChange}\n                valueLabelDisplay=\"auto\"\n                min={0}\n                max={1}\n                step={0.01}\n              />\n            </ListItem>\n          <ListItem>\n            <ListItemText id=\"infectiousPeriod\" primary=\"Mean Infectious Days\" />\n              <Slider\n                value={infectiousPeriodMean}\n                aria-labelledby=\"continuous-slider\"\n                onChange={handleInfectiousPeriodMean}\n                valueLabelDisplay=\"auto\"\n                min={3}\n                max={12}\n                step={0.1}\n              />\n          </ListItem>\n        </List>\n          </AccordionDetails>\n        </Accordion>\n        </Grid>\n    </Grid>\n    <Grid container direction=\"row\" justify=\"center\" className={classes.root} spacing={3}>\n\n    </Grid>\n    </div>\n  )\n}\n\nexport default InfectiousMatterContainer;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport InfectiousMatterContainer from './SimComponents/InfectiousMatterContainer.js';\n\nReactDOM.render(\n  <React.StrictMode>\n    <InfectiousMatterContainer />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","var uniqid = require(\"uniqid\");\n\n//TODO: Add multiple graphs, and subscribe events to them\n//TODO: \n\nfunction Agent(body) {\n\tthis.track_all_contacts = true;\n\tthis.state = undefined;\n\tthis.body = body;\n\tthis.interaction_callback = undefined;\n\tthis.uuid = uniqid();\n\tthis.viva_color = undefined;\n\tthis.events = [];\n\n\tthis.location = undefined;\n\tthis.home = undefined;\n\tthis.cohorts = [];\n\tthis.color = undefined;\n\tthis.home_state = {};\n\tthis.migrating = false;\n\tthis.masked = false;\n}\n\nAgent.prototype.add_body = function(body) {\n\tthis.body = body;\n}\n\nAgent.prototype.register_interaction_callback = function (interaction_callback) {\n\tthis.interaction_callback = interaction_callback;\n}\n\nAgent.prototype.handle_agent_contact = function(other_agent) {\n\tthis.interaction_callback(other_agent);\n}\n\nAgent.prototype.draw_mask = function(ctx, agent_size) {\n\tctx.fillStyle = \"#FFFFFF\";\n\tctx.strokeStyle=\"#000000\";\n\tctx.lineWidth = 1;\n\tctx.fillRect(this.body.position.x-agent_size, this.body.position.y, agent_size*2, agent_size-1);\n\tctx.strokeRect(this.body.position.x-agent_size, this.body.position.y, agent_size*2, agent_size-1);\n\tctx.stroke()\n\n}\n\nmodule.exports = Agent;\n"],"sourceRoot":""}