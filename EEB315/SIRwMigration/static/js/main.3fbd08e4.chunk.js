(this.webpackJsonpinfectious_matter_component=this.webpackJsonpinfectious_matter_component||[]).push([[0],{331:function(e,t,n){var a=n(235);function o(e){this.track_all_contacts=!0,this.state=void 0,this.body=e,this.interaction_callback=void 0,this.uuid=a(),this.viva_color=void 0,this.events=[],this.location=void 0,this.home=void 0,this.cohorts=[],this.color=void 0,this.home_state={},this.migrating=!1,this.masked=!1,this.pathogen=void 0,this.birthtime=void 0,this.lifetime=void 0}o.prototype.add_body=function(e){this.body=e},o.prototype.register_interaction_callback=function(e){this.interaction_callback=e},o.prototype.handle_agent_contact=function(e){this.interaction_callback(e)},o.prototype.draw_mask=function(e,t){e.fillStyle="#FFFFFF",e.strokeStyle="#000000",e.lineWidth=1,e.fillRect(this.body.position.x-t,this.body.position.y,2*t,t-1),e.strokeRect(this.body.position.x-t,this.body.position.y,2*t,t-1),e.stroke()},e.exports=o},382:function(e,t,n){e.exports=n(506)},424:function(e,t,n){var a={name:"matter-collision-events",version:"0.1.5",for:"matter-js@^0.12.0",install:function(e){var t=e.Body.create;e.Body.create=function(){var e=t.apply(null,arguments);return e.onCollide=function(t){e._mceOC=t},e.onCollideEnd=function(t){e._mceOCE=t},e.onCollideActive=function(t){e._mceOCA=t},e},e.after("Engine.create",(function(){e.Events.on(this,"collisionStart",(function(t){t.pairs.map((function(t){e.Events.trigger(t.bodyA,"onCollide",{pair:t}),e.Events.trigger(t.bodyB,"onCollide",{pair:t}),t.bodyA._mceOC&&t.bodyA._mceOC(t),t.bodyB._mceOC&&t.bodyB._mceOC(t)}))})),e.Events.on(this,"collisionActive",(function(t){t.pairs.map((function(t){e.Events.trigger(t.bodyA,"onCollideActive",{pair:t}),e.Events.trigger(t.bodyB,"onCollideActive",{pair:t}),t.bodyA._mceOCA&&t.bodyA._mceOCA(t),t.bodyB._mceOCA&&t.bodyB._mceOCA(t)}))})),e.Events.on(this,"collisionEnd",(function(t){t.pairs.map((function(t){e.Events.trigger(t.bodyA,"onCollideEnd",{pair:t}),e.Events.trigger(t.bodyB,"onCollideEnd",{pair:t}),t.bodyA._mceOCE&&t.bodyA._mceOCE(t),t.bodyB._mceOCE&&t.bodyB._mceOCE(t)}))}))}))}};n(108).Plugin.register(a),e.exports.MatterCollisionEvents=a},428:function(e,t,n){var a=n(235);function o(e,t){return Math.random()*(t-e)+e}function i(e){this.name=e,this.uuid=a(),this.bounds=void 0,this.friction=.2,this.occupants=[],this.border_color=void 0}i.prototype.draw_borders=function(e,t){t=t&&this.border_color?t||this.border_color:"black";var n=this.bounds.max.x-this.bounds.min.x,a=this.bounds.max.y-this.bounds.min.y;e.beginPath(),e.rect(this.bounds.min.x-2,this.bounds.min.y-2,n+4,a+4),e.strokeStyle=t,e.lineWidth=2,e.stroke()},i.prototype.get_random_position=function(){return this.bounds?{x:o(this.bounds.min.x,this.bounds.max.x),y:o(this.bounds.min.y,this.bounds.max.y)}:{x:0,y:0}},i.prototype.remove_agent=function(e){this.occupants=this.occupants.filter((function(t){return t!==e})),e.location=void 0},i.prototype.set_bounds=function(e){this.bounds=e},i.prototype.migrate_to=function(e,t,n){this.remove_agent(t),e.add_agent(t),n&&n(t)},i.prototype.try_getting_random_residents=function(e){for(var t,n=[],a=0;a<e;a++){var o=(t=this.occupants)[Math.floor(t.length*Math.random())];o&&0==o.migrating&&n.push(o)}return n},i.prototype.add_agent=function(e){this.occupants.push(e),e.location=this},e.exports=i},429:function(e,t){function n(){this.members=[]}n.prototype.move_cohort=function(e,t){for(var n=0;n<this.members.length;n++){var a=this.members[n];a.location.migrate_to(e,a,t)}},n.prototype.send_cohort_home=function(e){for(var t=0;t<this.members.length;t++){var n=this.members[t];n.location.migrate_to(n.home,n,e)}},n.prototype.add_agent=function(e,t){this.members.push(e),e.cohorts.push(this),t&&t(e)},e.exports=n},430:function(e,t,n){var a=n(431),o=n(330);function i(){this.fast_queue=new a((function(e,t){return e.time<t.time}))}i.prototype.add_event=function(e,t){o(t.time&&t.callback),t.original_time=t.time,t.time+=e,this.fast_queue.add(t)},i.prototype.run_events_fired=function(e,t){for(var n=0;this.fast_queue.peek()&&this.fast_queue.peek().time<e&&n<t;){var a=this.fast_queue.poll();0==a.stale&&(a.recurring&&this.add_event(e,{time:a.original_time,callback:a.callback,recurring:!0,stale:!1}),a.callback(),n+=1)}},i.prototype.clear_events=function(){this.fast_queue=null,this.fast_queue=new a((function(e,t){return e.time<t.time}))},e.exports=i},506:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(14),r=n.n(i),s=n(25),c=n(351),u=n(534),_=n(350),l=n(537),d=n(62),m=n(78),p=n(235),f=function(e){var t=e.color_float+m.jStat.exponential.sample(8),n=Math.max(Math.min(e.contagiousness+m.jStat.normal.sample(0,.05),1),0);t%=1,this.color_float=t,this.contagiousness=n};function g(e,t,n){this.parent=void 0,this.interaction_callback=void 0,this.uuid=p(),this.color_float=e||Math.random(),this.mutation_function=f,this.contagiousness=n}g.prototype.get_lifespan_multiplier=function(){return 1.01-this.contagiousness},g.prototype.get_offspring=function(e){var t=new g(this.color_float);return t.contagiousness=this.contagiousness,Math.random()<e&&this.mutation_function&&t.mutation_function(this),t};var y=g,h=n(108),b=(n(111),function(e){var t=e.InfectiousMatterRef,n=e.InfectiousMatterAPI,i=e.redraw_trigger,r=e.setWorldReadyTrigger,s=e.numMasked,c=Object(a.useRef)(null),u=function(e){var a=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.01,bounds:{min:{x:20,y:20},max:{x:130,y:130}}}}}),o=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:20,y:150},max:{x:130,y:250}}}}}),i=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:20,y:270},max:{x:130,y:380}}}}}),r=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:150,y:20},max:{x:260,y:130}}}}}),s=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:150,y:150},max:{x:260,y:250}}}}}),c=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:150,y:270},max:{x:260,y:380}}}}}),u=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:280,y:20},max:{x:380,y:130}}}}}),_=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:280,y:150},max:{x:380,y:250}}}}}),l=n(t,{type:"add_location",payload:{residence_props:{type:"residence",friction:.02,bounds:{min:{x:280,y:270},max:{x:380,y:380}}}}});n(t,{type:"add_agents",payload:{residence:a,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:o,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:i,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:r,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:s,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:c,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:u,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:_,num_agents:70}}),n(t,{type:"add_agents",payload:{residence:l,num_agents:70}}),t.current.add_event({time:1e3,callback:t.current.new_migration_event(),recurring:!0,stale:!1}),n(t,{type:"add_migration_link",payload:{from_location:a.uuid,to_location:o.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:o.uuid,to_location:i.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:i.uuid,to_location:r.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:a.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:s.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:c.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:u.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:_.uuid,num_agents:2}}),n(t,{type:"add_migration_link",payload:{from_location:r.uuid,to_location:l.uuid,num_agents:2}}),h.Common.shuffle(t.current.agents),n(t,{type:"set_num_mask",payload:{num_masked:e}})};return Object(a.useEffect)((function(){var e={sim_time_per_day:2e3,agent_size:3,link_lifetime:2e3};e.link_lifetime=7*e.sim_time_per_day;console.log("initalizing matter"),t.current=new z(!1,e,{per_contact_infection:.5,incubation_period_mu:5,incubation_period_sigma:3,infectious_period_mu:7,infectious_period_sigma:4,fraction_asymptomatic:.2,asymptomatic_infectious_period_mu:1.5,asymptomatic_infectious_period_sigma:1.5,fraction_seek_care:.5,fraction_isolate:.2,time_to_seek_care:2.5,movement_scale:2,use_pathogen_contagiousness:!0},{viva_colors:[2473647103,16711935,4294902015,4289003775,65535,2846468607,4278255615,13554175,2566625535,3448061951],matter_colors:["mediumpurple","lime","yellow","orange","blue","darkgrey","fuchsia","darkturquoise","palegreen","peru"]}),n(t,{type:"setup_environment",payload:{sim_div:c}}),u(s)}),[]),Object(a.useLayoutEffect)((function(){t.current&&(u(s),r((function(e){return e+1})))}),[i]),o.a.createElement("div",null,o.a.createElement("div",{ref:c,style:{height:400,width:400}}))}),v=n(108);n(423);var k=n(424).MatterCollisionEvents;v.use("matter-wrap",k),v._seed=2,Math.random=v.Common.random,m.jStat._random_fn=v.Common.random;var E=n(330),j=n(111),x=new j.Graph.graph,O=n(428),C=n(429),w=n(430),I=n(331),S=n(432),M=(S({colormap:"chlorophyll",nshades:9,format:"hex",alpha:1}),S({colormap:"portland",nshades:15,format:"hex",alpha:1}),n(434)(["white"])),A={SUSCEPTIBLE:0,INFECTED:1,RECOVERED:2,size:3},R=v.Engine,L=v.Render,P=v.World,B=(v.Body,v.Bodies),D=(v.Bounds,v.Mouse),N=v.MouseConstraint,T=v.Events,F={sim_time_per_day:1e3,agent_size:3,link_lifetime:3e3,pathogen_mut_prob:.3,agent_lifespan:50},q={per_contact_infection:.5,incubation_period_mu:5,incubation_period_sigma:3,infectious_period_mu:7,infectious_period_sigma:4,fraction_asymptomatic:.2,asymptomatic_infectious_period_mu:1.5,asymptomatic_infectious_period_sigma:1.5,fraction_seek_care:.5,fraction_isolate:.2,time_to_seek_care:2.5,movement_scale:.2,use_pathogen_contagiousness:!0},W={viva_colors:[2332068863,16711935,4294902015,4289003775,65535,2846468607,4278255615,13554175,2566625535,3448061951],matter_colors:["darkmagenta","lime","yellow","orange","blue","darkgrey","fuchsia","darkturquoise","palegreen","peru"]};function z(e,t,n,a){this.simulation_params=v.Common.extend(F,t),this.infection_params=v.Common.extend(q,n),this.simulation_colors=v.Common.extend(W,a),this.matter_world=P.create(),this.headless=e||!1,this.pathogen_color_range=M,console.log("creating infectious matter environment!"),this.matter_engine=R.create({positionIterations:15,velocityIterations:15,constraintIterations:10}),this.matter_engine.world.gravity.y=0,this.event_queue=new w,this.migration_graph=new j.Graph.graph}z.prototype.setup_renderer=function(e){var t=e;this.matter_render=L.create({element:t,engine:this.matter_engine,options:{height:t.offsetHeight,width:t.offsetWidth,background:"rgba(229,229,229)",wireframes:!1}});var n=D.create(this.matter_render.canvas);this.mouseConstraint=N.create(this.matter_engine,{mouse:n,constraint:{stiffness:.1,render:{visible:!0}}}),n.element.removeEventListener("mousewheel",n.mousewheel),n.element.removeEventListener("DOMMouseScroll",n.mousewheel),this.matter_render.mouse=n,P.add(this.matter_engine.world,this.mouseConstraint),L.run(this.matter_render),R.run(this.matter_engine)},z.prototype.run_headless=function(e){if(e=e||30,this.run_headless)for(var t=0;t<e*this.simulation_params.sim_time_per_day;t++){this.event_queue.run_events_fired(this.cur_sim_time,500);v.Common.choose(this.agents);R.update(this.matter_engine,1e3/60),this.cur_sim_time=this.matter_engine.timing.timestamp}},z.prototype.setup_matter_env=function(){var e=this;x.clear(),this.locations=[],this.migration_graph.clear(),this.location_uuid_hash={},this.agents=[],this.cohorts=[],this.cur_sim_time=0,this.state_counts=[],this.matter_engine.timing.timestamp=0;for(var t=0;t<A.size;t++)this.state_counts.push(0);this.headless||(T.on(this.matter_render,"beforeRender",(function(t){e.cur_sim_time=t.timestamp,e.event_queue.run_events_fired(e.cur_sim_time,500)})),T.on(this.matter_render,"afterRender",(function(t){var n=e.matter_render.context;if(n){for(var a=0;a<e.locations.length;a++)e.locations[a].draw_borders(n);e.agents.forEach((function(t){t.masked&&t.draw_mask(n,e.simulation_params.agent_size)}))}}))),this.add_event({time:100,callback:this.pulse_orgs_event(),recurring:!0,stale:!1})},z.prototype.update_org_state=function(e,t){var n=e.agent_object.state;e.agent_object.state=t,"undefined"!==typeof n&&(this.state_counts[n]-=1),this.state_counts[t]+=1,e.render.lineWidth=3;var a=e.render.strokeStyle;switch(t){case A.INFECTED:a="red",4278190335;break;case A.RECOVERED:a="blue",4294967295;break;case A.SENSITIVE:e.render.lineWidth=0}return e.render.strokeStyle=a,e},z.prototype.add_location=function(e,t){var n=new O(e);return n.border_color=t.border_color,n.set_bounds(t.bounds),n.friction=t.friction,n.type=t.type||"none",n.home_color=this.simulation_colors.matter_colors[this.locations.length],n.viva_node_color=this.simulation_colors.viva_colors[this.locations.length],this.locations.push(n),this.location_uuid_hash[n.uuid]=n,n},z.prototype.add_cohort=function(){var e=new C;return this.cohorts.push(e),e},z.prototype.assign_cohort=function(e,t){t.add_agent(e.agent_object)},z.prototype.expose_org=function(e,t,n){var a=this;n&&n.pathogen?e.agent_object.pathogen=n.pathogen.get_offspring(this.simulation_params.pathogen_mut_prob):e.agent_object.pathogen=new y(.5,"root",this.infection_params.per_contact_infection),this.update_org_state(e,A.INFECTED),this.post_infection_callback&&this.post_infection_callback(e.agent_object,n);var o=Math.max(m.jStat.exponential.sample(1/this.infection_params.infectious_period_mu),3),i=e.agent_object.birthtime+e.agent_object.lifetime-this.cur_sim_time;if(e.agent_object.pathogen.get_lifespan_multiplier()*i<o*this.simulation_params.sim_time_per_day){var r={time:e.agent_object.pathogen.get_lifespan_multiplier()*i,callback:function(){a.delete_agent(e.agent_object)},stale:!1};this.add_event(r),e.agent_object.events.push(r);var s=e.agent_object.masked,c=e.agent_object.home;this.add_event({time:i,callback:function(){a.add_agent(c,A.SUSCEPTIBLE).agent_object.masked=s},stale:!1})}else{var u={time:o*this.simulation_params.sim_time_per_day,callback:function(){a.update_org_state(e,A.RECOVERED),e.agent_object.pathogen=void 0},stale:!1};this.add_event(u),e.agent_object.events.push(u)}},z.prototype.register_infection_callback=function(e){this.post_infection_callback=e},z.prototype._check_edge_for_removal=function(e){var t=this;return function(){e.data.timestamp<t.cur_sim_time-t.simulation_params.link_lifetime?x.removeLink(e):t.add_event({time:t.cur_sim_time+t.simulation_params.link_lifetime-e.data.timestamp,callback:t._check_edge_for_removal(e),stale:!1})}},z.prototype.calc_prob_infection=function(e,t){return this.infection_params.use_pathogen_contagiousness?t.agent_object.pathogen.contagiousness:this.infection_params.per_contact_infection},z.prototype._default_interaction_callback=function(e){var t=this;return function(n){n.state==A.INFECTED&&e.agent_object.state==A.SUSCEPTIBLE&&v.Common.random(0,1)<t.calc_prob_infection(e,n.body)&&t.expose_org(e,A.INFECTED,n),E(n.uuid&&e.agent_object.uuid);var a=x.hasLink(e.agent_object.uuid,n.uuid)||x.hasLink(n.uuid,e.agent_object.uuid);a?a.data.timestamp=t.cur_sim_time:(E(x.hasNode(e.agent_object.uuid)&&x.hasNode(e.agent_object.uuid)),a=x.addLink(e.agent_object.uuid,n.uuid,{origin:e.agent_object.uuid,timestamp:t.cur_sim_time}),t.add_event({time:t.simulation_params.link_lifetime+1,callback:t._check_edge_for_removal(a),stale:!1}))}},z.prototype.add_agent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.SUSCEPTIBLE;E(e&&e.get_random_position);var n=e.get_random_position(),a=B.circle(n.x,n.y,this.simulation_params.agent_size,{plugin:{wrap:e.bounds}});a.render.fillStyle=e.home_color||"black",a.strokeStyle="black",a.lineWidth=2,a.agent_object=new I(a),a.frictionAir=e.friction,a.friction=0,a.restitution=1.1,a.agent_object.home=e,a.agent_object.viva_color=e.viva_node_color,a.agent_object.lifetime=m.jStat.exponential.sample(1/(this.simulation_params.agent_lifespan*this.simulation_params.sim_time_per_day)),a.agent_object.birthtime=this.cur_sim_time,a.node=x.addNode(a.agent_object.uuid,{agent_object:a.agent_object,viva_color:e.viva_node_color}),e.add_agent(a.agent_object),this.agents.push(a.agent_object),this.update_org_state(a,t),a.agent_object.register_interaction_callback(this._default_interaction_callback(a,this.get_prob_of_infection)),a.onCollide((function(e){e.bodyA===a&&e.bodyB.agent_object?e.bodyA.agent_object.handle_agent_contact(e.bodyB.agent_object):e.bodyB===a&&e.bodyA.agent_object&&e.bodyB.agent_object.handle_agent_contact(e.bodyA.agent_object)})),P.add(this.matter_engine.world,a);var o={time:a.agent_object.lifetime,callback:this._death_birth(a.agent_object),recurring:!1,stale:!1};return this.add_event(o),a.agent_object.events.push(o),a},z.prototype._death_birth=function(e){var t=this;return function(){var n=e.home,a=e.masked;t.delete_agent(e),t.add_agent(n).agent_object.masked=a}},z.prototype.delete_agent=function(e){e.location.remove_agent(e),this.agents=this.agents.filter((function(t){return t!==e})),v.Composite.remove(this.matter_engine.world,e.body),x.removeNode(e.uuid),this.state_counts[e.state]-=1,e.events.forEach((function(e){e.stale=!0}))},z.prototype.add_event=function(e){E(e.time&&e.callback),this.event_queue.add_event(this.cur_sim_time,e)},z.prototype.set_agent_contact_callback=function(e){this.agent_contact_callback=e},z.prototype.clear_simulator=function(){P.clear(this.matter_engine.world),R.clear(this.matter_engine),this.event_queue.clear_events()},z.prototype.remove_simulator=function(){this.clear_simulator(),L.stop(),this.matter_engine.events={},this.matter_render.canvas.remove(),this.matter_render.canvas=null,this.matter_render.context=null,this.matter_render.textures={},this.matter_world=null,this.matter_engine=null,this.event_queue=null,this.matter_render=null,this.mouseConstraint=null},z.prototype.pulse_orgs_event=function(){var e=this;return function(){if(e.agents.length>0)for(var t=0;t<100;t++){var n=v.Common.choose(e.agents);v.Body.applyForce(n.body,n.body.position,{x:v.Common.random(-2e-5*e.infection_params.movement_scale,2e-5*e.infection_params.movement_scale),y:v.Common.random(-2e-5*e.infection_params.movement_scale,2e-5*e.infection_params.movement_scale)})}}},z.prototype.get_migration_links=function(){var e=[];return this.migration_graph.forEachLink((function(t){e.push({from_uuid:t.fromId,to_uuid:t.toId,num_agents:t.data.num_agents})})),e},z.prototype.add_migration_link=function(e,t,n){var a=this.migration_graph.hasLink(e,t);a?a.data.num_agents=n:this.migration_graph.addLink(e,t,{num_agents:n})},z.prototype.remove_migration_link=function(e,t){var n=this.migration_graph.hasLink(e,t);n&&this.migration_graph.removeLink(n)},z.prototype.new_migration_event=function(){var e=this;return function(){e.migration_graph.forEachLink((function(t){var n=e.location_uuid_hash[t.fromId],a=e.location_uuid_hash[t.toId];n.try_getting_random_residents(t.data.num_agents).forEach((function(t){t.home_state={location:n,position:Object(d.a)({},t.body.position),velocity:Object(d.a)({},t.body.velocity)},n.migrate_to(a,t,(function(e){e.body.plugin.wrap=a.bounds,v.Body.setPosition(e.body,a.get_random_position()),e.body.frictionAir=a.friction,e.migrating=!0})),e.add_event({time:e.simulation_params.sim_time_per_day,callback:function(){a.migrate_to(n,t,(function(e){v.Body.setPosition(e.body,t.home_state.position),e.body.plugin.wrap=n.bounds,v.Body.setVelocity(e.body,t.home_state.velocity),e.body.frictionAir=n.friction,e.migrating=!1}))},stale:!1})}))}))}};n(331);var V=n(111),U=n.n(V),G=U.a.Graph.Layout.forceDirected(x,{springLength:15,springCoeff:5e-5,dragCoeff:.01,gravity:-1.5}),H=U.a.Graph.View.webglGraphics(),J=function(e){var t=e.InfectiousMatterRef,n=e.InfectiousMatterAPI,i=e.worldReadyTrigger,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){console.log("initalizing viva graph");var e=U.a.Graph.View.renderer(x,{container:r.current,graphics:H,renderLinks:!0,layout:G,interactive:"node drag"});e.run();for(var t=0;t<30;t++)e.zoomOut();x.on("changed",(function(e){e.forEach((function(e){e.node&&"add"==e.changeType&&(H.getNodeUI(e.node.id).color=e.node.data.agent_object.viva_color,H.getNodeUI(e.node.id).size=40)}))}))}),[]),Object(a.useEffect)((function(){n(t,{type:"forEach_agents",payload:{callback:function(e){H.getNodeUI(e.uuid).color=e.viva_color,H.getNodeUI(e.uuid).size=40}}})}),[i]),o.a.createElement("div",{ref:r,style:{width:400,height:400}})},K=n(93),Q=n(184),X=n.n(Q);var Y=function(e){var t=e.InfectiousMatterRef,n=e.InfectiousMatterAPI,i=e.worldReadyTrigger,r=Object(a.useState)([]),c=Object(s.a)(r,2),u=c[0],_=c[1],l=Object(a.useState)({}),m=Object(s.a)(l,2),p=m[0],f=m[1],g=Object(a.useState)(null),y=Object(s.a)(g,2),h=(y[0],y[1],Object(a.useState)(0)),b=Object(s.a)(h,2),v=b[0],k=b[1],E=Object(a.useState)([]),j=Object(s.a)(E,2),x=j[0],O=j[1],C=Object(a.useState)([{title:"From Location",field:"from_uuid",type:"numeric"},{title:"To Location",field:"to_uuid",type:"numeric"},{title:"Visitors/Day",field:"num_agents",type:"numeric"}]),w=Object(s.a)(C,2),I=w[0],S=w[1],M=function(e,t){return e.to_uuid!=t.to_uuid||e.from_uuid!=t.from_uuid||e.num_agents!=t.num_agents};return Object(a.useEffect)((function(){S([{title:"From Location",field:"from_uuid",type:"numeric",lookup:p,editable:"onAdd"},{title:"To Location",field:"to_uuid",type:"numeric",lookup:p,editable:"onAdd"},{title:"Visitors/Day",field:"num_agents",type:"numeric"}])}),[p]),Object(a.useEffect)((function(){x.length>0&&x.forEach((function(e){n(t,{type:"add_migration_link",payload:{from_location:e.from_uuid,to_location:e.to_uuid,num_agents:e.num_agents}})}))}),[v]),Object(a.useEffect)((function(){var e=Object(d.a)({},p),a=n(t,{type:"map_locations",payload:{callback:function(e,t){return{location_idx:t,location_uuid:e.uuid}}}});_(a);var o=n(t,{type:"get_migration_links"});x.length>0&&e&&(n(t,{type:"clear_migration_links"}),o=x.map((function(t){var n=e[t.from_uuid],o=e[t.to_uuid];return{from_uuid:a[n].location_uuid,to_uuid:a[o].location_uuid,num_agents:t.num_agents}}))),O(o),k((function(e){return e+1}))}),[i]),Object(a.useEffect)((function(){var e={};u.forEach((function(t){e[t.location_uuid]=t.location_idx})),S([{title:"From Location",field:"from_uuid",type:"numeric",lookup:p,editable:"onAdd"},{title:"To Location",field:"to_uuid",type:"numeric",lookup:e,editable:"onAdd"},{title:"Visitors/Day",field:"num_agents",type:"numeric"}]),f(e)}),[u]),o.a.createElement(X.a,{title:"Migration Links",columns:I,data:x,options:{filtering:!1,toolbar:!0,search:!1,pageSizeOptions:[5]},editable:{onRowAdd:function(e){return new Promise((function(t,n){var a;a=e,!(x.find((function(e){return e.to_uuid==a.to_uuid&&e.from_uuid==a.from_uuid}))||a.num_agents<0)&&(O([].concat(Object(K.a)(x),[a])),k((function(e){return e+1})));t()}))},onRowUpdate:function(e,t){return new Promise((function(n,a){!function(e,t){var n=Object(K.a)(x),a=x.findIndex((function(e){return e.to_uuid==t.to_uuid&&e.from_uuid==t.from_uuid}));M(e,t)&&(n[a]=e,O(n),k((function(e){return e+1})))}(e,t),n()}))},onRowDelete:function(e){return new Promise((function(a,o){!function(e){var a=x.filter((function(t){return M(e,t)}));O(a),n(t,{type:"remove_migration_link",payload:{from_location:e.from_uuid,to_location:e.to_uuid}}),k((function(e){return e+1}))}(e),a()}))}}})},Z=n(202),$=n.n(Z),ee={margin:{l:50,r:10,b:50,t:10,pad:10},showlegend:!0,legend:{x:1,xanchor:"right",y:1},xaxis:{title:"Contagiousness",rangemode:"nonnegative"},yaxis:{title:"Density",rangemode:"nonnegative"},width:390,height:390},te=[{x:[],name:"Contagiousness",type:"histogram",marker:{color:"grey"}}];function ne(e,t){e||console.log("didnt get state");var n=Object(K.a)(e);switch(t.type){case"set":return n[0].x=t.payload.cur_contagousness,n[0].name="Mean Contagiousness: "+m.jStat.mean(t.payload.cur_contagousness).toPrecision(3),n;case"extend":return n[0].x.push(t.payload.cur_time),n[0].y.push(t.payload.cur_state_counts[A.INFECTED]),n[1].x.push(t.payload.cur_time),n[1].y.push(t.payload.cur_state_counts[A.RECOVERED]),n[2].x.push(t.payload.cur_time),n[2].y.push(t.payload.cur_state_counts[A.SUSCEPTIBLE]),n;case"reset":return n=[{x:[],name:"Contagiousness",type:"histogram",marker:{color:"grey"}}]}}var ae=function(e){var t=e.InfectiousMatterRef,n=e.InfectiousMatterAPI,i=e.redraw_trigger,r=Object(a.useReducer)(ne,te),c=Object(s.a)(r,2),u=c[0],_=c[1],l=Object(a.useState)(0),m=Object(s.a)(l,2),p=m[0],f=m[1],g=ee;return Object(a.useEffect)((function(){var e=setInterval((function(){!function(){var e=n(t,{type:"map_agents",payload:{callback:function(e,t){if(e.pathogen)return e.pathogen.contagiousness}}}).filter((function(e){return null!=e}));_({type:"set",payload:{cur_contagousness:e}}),f((function(e){return e+1}))}()}),600);return function(){clearInterval(e)}}),[i]),Object(a.useLayoutEffect)((function(){t.current&&(_({type:"reset"}),f((function(e){return e+1})))}),[i]),o.a.createElement($.a,{data:u,layout:Object(d.a)(Object(d.a)({},g),{},{datarevision:p})})},oe={margin:{l:50,r:10,b:50,t:10,pad:10},showlegend:!0,legend:{x:1,xanchor:"right",y:1},xaxis:{title:"Days",rangemode:"nonnegative"},yaxis:{title:"Count",rangemode:"nonnegative"},width:390,height:390},ie=[{x:[0],y:[0],type:"scatter",name:"Infected",marker:{color:"red"}},{x:[0],y:[0],name:"Recovered",type:"scatter",marker:{color:"green"}},{x:[0],y:[0],name:"Susceptible",type:"scatter",marker:{color:"grey"}}];function re(e,t){e||console.log("didnt get state");var n=Object(K.a)(e);switch(t.type){case"extend":return n[0].x.push(t.payload.cur_time),n[0].y.push(t.payload.cur_state_counts[A.INFECTED]),n[1].x.push(t.payload.cur_time),n[1].y.push(t.payload.cur_state_counts[A.RECOVERED]),n[2].x.push(t.payload.cur_time),n[2].y.push(t.payload.cur_state_counts[A.SUSCEPTIBLE]),n;case"reset":return n=[{x:[0],y:[0],type:"scatter",name:"Infected",marker:{color:"red"}},{x:[0],y:[0],name:"Recovered",type:"scatter",marker:{color:"green"}},{x:[0],y:[0],name:"Susceptible",type:"scatter",marker:{color:"grey"}}]}}var se=function(e){var t=e.InfectiousMatterRef,n=e.InfectiousMatterAPI,i=e.redraw_trigger,r=Object(a.useReducer)(re,ie),c=Object(s.a)(r,2),u=c[0],_=c[1],l=Object(a.useState)(0),m=Object(s.a)(l,2),p=m[0],f=m[1],g=oe;return Object(a.useEffect)((function(){var e=setInterval((function(){!function(){var e=n(t,{type:"get_state_counts"});_({type:"extend",payload:{cur_time:e.cur_time,cur_state_counts:e.state_counts}}),f((function(e){return e+1}))}()}),600);return function(){clearInterval(e)}}),[i]),Object(a.useLayoutEffect)((function(){t.current&&(_({type:"reset"}),f((function(e){return e+1})))}),[i]),o.a.createElement($.a,{data:u,layout:Object(d.a)(Object(d.a)({},g),{},{datarevision:p})})},ce=n(108),ue=n.n(ce),_e=n(540),le=n(514),de=n(508),me=n(355),pe=n(538),fe=Object(_.a)((function(e){return{root:{flexGrow:0,minWidth:1200},controlls:{width:600},paper:{minHeight:400,minWidth:400,textAlign:"center"},paperControlls:{minHeight:400,minWidth:400,textAlign:"center",padding:e.spacing(2)}}}));z.prototype.mask_transmission_props={self_protection:.05,others_protection:.5},z.prototype.calc_prob_infection=function(e,t){},z.prototype.calc_prob_infection=function(e,t){var n=this.infection_params.per_contact_infection;return this.infection_params.use_pathogen_contagiousness&&(n=t.agent_object.pathogen.contagiousness),e.agent_object.masked&&t.agent_object.masked?n*(1-this.mask_transmission_props.self_protection)*(1-this.mask_transmission_props.others_protection):e.agent_object.masked&&!t.agent_object.masked?n*(1-this.mask_transmission_props.self_protection):!e.agent_object.masked&&t.agent_object.masked?n*(1-this.mask_transmission_props.others_protection):e.agent_object.masked||t.agent_object.masked?void 0:n};var ge=function(e,t){if("setup_environment"==t.type&&(e.current.setup_renderer(t.payload.sim_div.current),e.current.setup_matter_env()),"update_mask_transmission_params"==t.type&&(t.payload.self_protection&&(e.current.mask_transmission_props.self_protection=t.payload.self_protection),t.payload.others_protection&&(e.current.mask_transmission_props.others_protection=t.payload.others_protection)),"update_movement_scale"==t.type&&t.payload.movement_scale&&(e.current.infection_params.movement_scale=t.payload.movement_scale),"reset_simulator"==t.type&&(e.current.clear_simulator(),e.current.setup_matter_env()),"add_location"==t.type)return e.current.add_location("residence",t.payload.residence_props);if("add_agents"==t.type){var n=null;if(t.payload.residence&&t.payload.num_agents)for(var a=0;a<t.payload.num_agents;a++)n=e.current.add_agent(t.payload.residence);t.payload.callback&&n&&t.payload.callback(n.agent_object)}if("map_agents"==t.type)return e.current.agents.map((function(e,n){return t.payload.callback(e,n)}));if("forEach_agents"==t.type&&e.current.agents.forEach((function(e){return t.payload.callback(e)})),"map_locations"==t.type)return e.current.locations.map((function(e,n){return t.payload.callback(e,n)}));if("forEach_location"==t.type&&e.current.locations.forEach((function(e){return t.payload.callback(e)})),"infect_random_agents"==t.type&&t.payload.num_agents)for(var o=0;o<t.payload.num_agents;o++){var i=ue.a.Common.choose(e.current.agents);e.current.expose_org(i.body,A.INFECTED)}if("get_migration_links"==t.type)return e.current.get_migration_links();if("add_migration_link"==t.type&&e.current.add_migration_link(t.payload.from_location,t.payload.to_location,t.payload.num_agents),"clear_migration_links"==t.type&&e.current.migration_graph.clear(),"remove_migration_link"==t.type&&e.current.remove_migration_link(t.payload.from_location,t.payload.to_location),"get_state_counts"==t.type)return{state_counts:e.current.state_counts,cur_time:e.current.cur_sim_time/e.current.simulation_params.sim_time_per_day};if("set_num_mask"==t.type){var r=[],s=[];e.current.agents.forEach((function(e){e.masked?r.push(e):s.push(e)}));var c=r.length,u=t.payload.num_masked-c;if(u>0)for(var _=0;_<u;_++)s[_].masked=!0;else if(u<0)for(var l=0;l<-u;l++)r[l].masked=!1}"update_infection_params"==t.type&&(t.payload.per_contact_infection&&(e.current.infection_params.per_contact_infection=t.payload.per_contact_infection),t.payload.infectious_period_mu&&(e.current.infection_params.infectious_period_mu=t.payload.infectious_period_mu)),"update_agent_lifespan"==t.type&&t.payload.agent_lifespan&&(e.current.simulation_params.agent_lifespan=t.payload.agent_lifespan)},ye=function(e){var t=fe(),n=Object(a.useRef)(null),i=Object(a.useState)(0),r=Object(s.a)(i,2),_=r[0],d=r[1],m=Object(a.useState)(.05),p=Object(s.a)(m,2),f=p[0],g=p[1],y=Object(a.useState)(.5),h=Object(s.a)(y,2),v=h[0],k=h[1],E=Object(a.useState)(2),j=Object(s.a)(E,2),x=j[0],O=j[1],C=Object(a.useState)(50),w=Object(s.a)(C,2),I=w[0],S=w[1],M=Object(a.useState)(.5),A=Object(s.a)(M,2),R=A[0],L=A[1],P=Object(a.useState)(5),B=Object(s.a)(P,2),D=B[0],N=B[1],T=Object(a.useState)(0),F=Object(s.a)(T,2),q=F[0],W=F[1],z=Object(a.useState)(0),V=Object(s.a)(z,2),U=V[0],G=V[1];return Object(a.useEffect)((function(){ge(n,{type:"update_mask_transmission_params",payload:{self_protection:f}})}),[f]),Object(a.useEffect)((function(){ge(n,{type:"update_mask_transmission_params",payload:{others_protection:v}})}),[v]),Object(a.useEffect)((function(){ge(n,{type:"update_movement_scale",payload:{movement_scale:x}})}),[x]),Object(a.useEffect)((function(){ge(n,{type:"set_num_mask",payload:{num_masked:_}})}),[_]),Object(a.useEffect)((function(){ge(n,{type:"update_infection_params",payload:{per_contact_infection:R}})}),[R]),Object(a.useEffect)((function(){ge(n,{type:"update_infection_params",payload:{infectious_period_mu:D}})}),[D]),Object(a.useEffect)((function(){ge(n,{type:"update_agent_lifespan",payload:{agent_lifespan:I}})}),[I]),o.a.createElement("div",{className:"App"},o.a.createElement(u.a,{container:!0,direction:"row",justify:"center",className:t.root,spacing:3},o.a.createElement(u.a,{item:!0},o.a.createElement(l.a,{className:t.paper},o.a.createElement(se,{InfectiousMatterRef:n,InfectiousMatterAPI:ge,redraw_trigger:q}))),o.a.createElement(u.a,{item:!0},o.a.createElement(l.a,{className:t.paper},o.a.createElement(ae,{InfectiousMatterRef:n,InfectiousMatterAPI:ge,redraw_trigger:q})))),o.a.createElement(u.a,{container:!0,direction:"row",justify:"center",className:t.root,spacing:3},o.a.createElement(u.a,{item:!0},o.a.createElement(l.a,{className:t.paper},o.a.createElement(b,{InfectiousMatterRef:n,InfectiousMatterAPI:ge,redraw_trigger:q,setWorldReadyTrigger:G,numMasked:_}))),o.a.createElement(u.a,{item:!0},o.a.createElement(l.a,{className:t.paper},o.a.createElement(J,{InfectiousMatterRef:n,InfectiousMatterAPI:ge,worldReadyTrigger:U})))),o.a.createElement(u.a,{container:!0,direction:"row",justify:"center",className:t.root,spacing:10},o.a.createElement(u.a,{item:!0},o.a.createElement(l.a,{className:t.paper},o.a.createElement(le.a,null,o.a.createElement(pe.a,{disableSticky:!0},"World Settings"),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"Movement",primary:"Movement Scale"}),o.a.createElement(_e.a,{value:x,"aria-labelledby":"discrete-slider",valueLabelDisplay:"on",onChange:function(e,t){O(t)},step:.25,min:0,max:10})),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"lifespan",primary:"Agent Lifespan"}),o.a.createElement(_e.a,{value:I,"aria-labelledby":"discrete-slider",valueLabelDisplay:"on",onChange:function(e,t){S(t)},step:5,min:5,max:200})),o.a.createElement(pe.a,{disableSticky:!0},"Infection Settings"),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"infectionRate",primary:"Prob. Infection"}),o.a.createElement(_e.a,{value:R,"aria-labelledby":"continuous-slider",onChange:function(e,t){L(t)},valueLabelDisplay:"on",min:0,max:1,step:.01})),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"infectiousPeriod",primary:"Mean Infectious Days"}),o.a.createElement(_e.a,{value:D,"aria-labelledby":"continuous-slider",onChange:function(e,t){N(t)},valueLabelDisplay:"on",min:3,max:12,step:.1})),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"Masks",primary:"Number Masked"}),o.a.createElement(_e.a,{value:_,"aria-labelledby":"discrete-slider",valueLabelDisplay:"on",onChange:function(e,t){d(t)},step:1,min:0,max:630})),o.a.createElement(de.a,null,o.a.createElement(u.a,{container:!0,direction:"row",spacing:3},o.a.createElement(u.a,{item:!0},o.a.createElement(c.a,{variant:"contained",onClick:function(e){ge(n,{type:"reset_simulator"}),W((function(e){return e+1}))}},"Reset")),o.a.createElement(u.a,{item:!0},o.a.createElement(c.a,{variant:"contained",onClick:function(e){ge(n,{type:"infect_random_agents",payload:{num_agents:1}})}},"Infect Random Agent")))),o.a.createElement(pe.a,{disableSticky:!0},"Mask Settings"),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"selfProtection",primary:"Self Protection"}),o.a.createElement(_e.a,{value:f,"aria-labelledby":"continuous-slider",onChange:function(e,t){g(t)},valueLabelDisplay:"on",min:0,max:1,step:.01})),o.a.createElement(de.a,null,o.a.createElement(me.a,{id:"othersProtection",primary:"Others Protection"}),o.a.createElement(_e.a,{value:v,"aria-labelledby":"continuous-slider",onChange:function(e,t){k(t)},valueLabelDisplay:"on",min:0,max:1,step:.01}))))),o.a.createElement(u.a,{item:!0,className:t.controlls},o.a.createElement(Y,{InfectiousMatterRef:n,InfectiousMatterAPI:ge,worldReadyTrigger:U}))))};r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(ye,null)),document.getElementById("root"))}},[[382,1,2]]]);
//# sourceMappingURL=main.3fbd08e4.chunk.js.map