{"version":3,"sources":["InfectiousMatter/agent.js","InfectiousMatter/MatterCollisionEvents.js","InfectiousMatter/location.js","InfectiousMatter/cohort.js","InfectiousMatter/event_queue.js","InfectiousMatter/pathogen.js","SimComponents/InfectiousMatterSimulation.js","InfectiousMatter/new_S.png","InfectiousMatter/new_I.png","InfectiousMatter/simulation.js","InfectiousMatter/new_R.png","SimComponents/InfectiousMatterContactGraph.js","SimComponents/InfectiousMatterPlot.js","SimComponents/InfectiousMatterContainer.js","index.js"],"names":["uniqid","require","Agent","body","this","track_all_contacts","state","undefined","interaction_callback","uuid","viva_color","location","home","cohorts","color","home_state","migrating","masked","prototype","add_body","register_interaction_callback","handle_agent_contact","other_agent","draw_mask","ctx","agent_size","fillStyle","strokeStyle","lineWidth","fillRect","position","x","y","strokeRect","stroke","module","exports","MatterCollisionEvents","name","version","for","install","matter","create","Body","apply","arguments","onCollide","cb","_mceOC","onCollideEnd","_mceOCE","onCollideActive","_mceOCA","after","Events","on","event","pairs","map","pair","trigger","bodyA","bodyB","Plugin","register","getRandomArbitrary","min","max","Math","random","Location","bounds","friction","occupants","border_color","draw_borders","width","height","beginPath","rect","get_random_position","remove_agent","agent","filter","a","set_bounds","migrate_to","destination","callback","add_agent","try_getting_random_residents","num_to_get","arr","to_return","i","temp_a","floor","length","push","Cohort","members","move_cohort","callback_for_agent","send_cohort_home","FastPriorityQueue","assert","EventQueue","fast_queue","b","time","add_event","cur_sim_time","q_event","original_time","add","run_events_fired","event_limit","num_events","peek","this_event","poll","recurring","clear_events","_mutate_random","new_color","color_float","jStat","exponential","sample","new_contagiousness","contagiousness","Pathogen","parent","console","log","mutation_function","get_offspring","mut_rate","new_pathogen","Matter","InfectiousMatterSimulation","InfectiousMatterRef","InfectiousMatterAPI","redraw_trigger","setWorldReadyTrigger","numMasked","sim_div","useRef","setup_world","num_to_mask","res1","type","payload","residence_props","res2","residence","num_agents","Common","shuffle","current","agents","num_masked","useEffect","simulation_params","sim_time_per_day","link_lifetime","InfectiousMatter","per_contact_infection","incubation_period_mu","incubation_period_sigma","infectious_period_mu","infectious_period_sigma","fraction_asymptomatic","asymptomatic_infectious_period_mu","asymptomatic_infectious_period_sigma","fraction_seek_care","fraction_isolate","time_to_seek_care","movement_scale","use_pathogen_contagiousness","viva_colors","matter_colors","useLayoutEffect","c","ref","style","use","_seed","_random_fn","_Viva","ContactGraph","Graph","graph","colormap","pathogen_color_range","nshades","format","alpha","interpolate","AgentStates","SUSCEPTIBLE","EXPOSED","A_INFECTED","S_INFECTED","RECOVERED","size","Engine","Render","World","Bodies","Mouse","Bounds","MouseConstraint","default_simulation_params","pathogen_mut_prob","default_infection_params","default_simulation_colors","run_headless","infection_params","simulation_colors","extend","matter_world","headless","matter_engine","positionIterations","velocityIterations","constraintIterations","world","gravity","event_queue","migration_graph","setup_renderer","div_ref","_div","matter_render","element","engine","options","offsetHeight","offsetWidth","background","wireframes","mouse","canvas","mouseConstraint","constraint","stiffness","render","visible","removeEventListener","mousewheel","run","timelimit","t","choose","update","timing","timestamp","setup_matter_env","clear","locations","location_uuid_hash","state_counts","e","context","forEach","pulse_orgs_event","update_org_state","org","new_state","old_state","agent_object","sprite","texture","new_iconI","SENSITIVE","new_iconS","add_location","location_properties","new_location","home_color","viva_node_color","add_cohort","new_cohort","assign_cohort","cohort","expose_org","eventual_infected_state","infecting_agent","transmision_prob","pathogen","post_infection_callback","normal","days_to_recover","register_infection_callback","_check_edge_for_removal","edge","data","removeLink","calc_prob_infection","agent_a_body","agent_b_body","_default_interaction_callback","this_agent_body","future_state","this_edge","hasLink","hasNode","addLink","origin","home_location","agent_state","loc","colorIcon","new_agent_body","circle","xScale","yScale","plugin","wrap","setInertia","Infinity","frictionAir","restitution","node","addNode","something","get_prob_of_infection","q_item","set_agent_contact_callback","agent_contact_callback","clear_simulator","remove_simulator","stop","events","remove","textures","temp_agent","applyForce","get_migration_links","forEachLink","link","from_uuid","fromId","to_uuid","toId","add_migration_link","from_location_uuid","to_location_uuid","num_agents_per_day","existing_edge","remove_migration_link","new_migration_event","source","dest","migrating_agent","velocity","setPosition","setVelocity","Viva","Layout","forceDirected","springLength","springCoeff","dragCoeff","View","webglGraphics","useStyles","makeStyles","theme","root","flexGrow","minWidth","controlls","paper","minHeight","textAlign","paperControlls","padding","spacing","mask_transmission_props","self_protection","others_protection","action","new_agent","agent_id","loc_idx","random_agent","infection_probs","from_location","to_location","cur_time","masked_list","unmasked_list","cur_num_masked","num_needing_masks","InfectiousMatterContainer","props","classes","useState","maskSelfProtection","maskOthersProtection","movementScale","setMovementScale","setRedrawTrigger","className","Grid","container","direction","justify","alignItems","item","Card","List","ListSubheader","disableSticky","ListItem","ListItemText","id","primary","Slider","value","valueLabelDisplay","onChange","newValue","step","Button","variant","onClick","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.7c2b7d35.chunk.js","sourcesContent":["var uniqid = require(\"uniqid\");\n\n//TODO: Add multiple graphs, and subscribe events to them\n//TODO: \n\nfunction Agent(body) {\n\tthis.track_all_contacts = true;\n\tthis.state = undefined;\n\tthis.body = body;\n\tthis.interaction_callback = undefined;\n\tthis.uuid = uniqid();\n\tthis.viva_color = undefined;\n\n\tthis.location = undefined;\n\tthis.home = undefined;\n\tthis.cohorts = [];\n\tthis.color = undefined;\n\tthis.home_state = {};\n\tthis.migrating = false;\n\tthis.masked = false;\n}\n\nAgent.prototype.add_body = function(body) {\n\tthis.body = body;\n}\n\nAgent.prototype.register_interaction_callback = function (interaction_callback) {\n\tthis.interaction_callback = interaction_callback;\n}\n\nAgent.prototype.handle_agent_contact = function(other_agent) {\n\tthis.interaction_callback(other_agent);\n}\n\nAgent.prototype.draw_mask = function(ctx, agent_size) {\n\n\tctx.fillStyle = \"#FFFFFF\";\n\tctx.strokeStyle=\"#000000\";\n\tctx.lineWidth = 1;\n\tctx.fillRect(this.body.position.x-0.5*agent_size, this.body.position.y-2-agent_size, agent_size*1, agent_size-1);\n\tctx.strokeRect(this.body.position.x-0.5*agent_size, this.body.position.y-2-agent_size, agent_size*1, agent_size-1);\n\tctx.stroke()\n\n\n}\n\nmodule.exports = Agent;\n","var Matter = require('matter-js');\nvar MatterCollisionEvents = {\n  name: 'matter-collision-events',\n  version: '0.1.5',\n  for: 'matter-js@^0.12.0',\n  install: function(matter) {\n    // add the onCollide, onCollideEnd, and onCollideActive callback handlers\n    // to the native Matter.Body created\n    var create = matter.Body.create;\n    matter.Body.create = function() {\n      var body = create.apply(null, arguments);\n      body.onCollide = function(cb) { body._mceOC = cb; }\n      body.onCollideEnd = function(cb) { body._mceOCE = cb; }\n      body.onCollideActive = function(cb) { body._mceOCA = cb; }\n      return body;\n    }\n    matter.after('Engine.create', function() {\n      matter.Events.on(this, 'collisionStart', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(pair.bodyA, 'onCollide', { pair : pair });\n          matter.Events.trigger(pair.bodyB, 'onCollide', { pair : pair });\n          pair.bodyA._mceOC &&\n            pair.bodyA._mceOC(pair)\n          pair.bodyB._mceOC &&\n            pair.bodyB._mceOC(pair)\n        });\n      });\n\n      matter.Events.on(this, 'collisionActive', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(\n            pair.bodyA,\n            'onCollideActive',\n            { pair: pair }\n          );\n          matter.Events.trigger(\n            pair.bodyB,\n            'onCollideActive',\n            { pair: pair }\n          );\n          pair.bodyA._mceOCA &&\n            pair.bodyA._mceOCA(pair)\n          pair.bodyB._mceOCA &&\n            pair.bodyB._mceOCA(pair)\n        });\n      });\n\n      matter.Events.on(this, 'collisionEnd', function(event) {\n        event.pairs.map(function(pair) {\n          matter.Events.trigger(pair.bodyA, 'onCollideEnd', { pair : pair });\n          matter.Events.trigger(pair.bodyB, 'onCollideEnd', { pair : pair });\n          pair.bodyA._mceOCE &&\n            pair.bodyA._mceOCE(pair)\n          pair.bodyB._mceOCE &&\n            pair.bodyB._mceOCE(pair)\n        });\n      });\n    });\n  },\n};\n\nMatter.Plugin.register(MatterCollisionEvents);\nmodule.exports.MatterCollisionEvents = MatterCollisionEvents;\n","var uniqid = require(\"uniqid\");\n\nfunction getRandomArbitrary(min, max) {\n  return Math.random() * (max - min) + min;\n}\n\nfunction getRandomChoice(arr) {\n    return arr[Math.floor(arr.length * Math.random())];\n}\n\nfunction Location(name) {\n\tthis.name = name;\n\tthis.uuid = uniqid();\n\tthis.bounds = undefined;\n\tthis.friction = 0.2;\n\tthis.occupants = [];\n\tthis.border_color = undefined;\n}\n\nLocation.prototype.draw_borders = function(ctx, strokeStyle) {\n\tif (!strokeStyle || !this.border_color){\n\t\tstrokeStyle = \"black\";\n\t} else {\n\t\tstrokeStyle = strokeStyle || this.border_color;\n\t}\n\n\n\tlet width = this.bounds.max.x - this.bounds.min.x;\n\tlet height = this.bounds.max.y - this.bounds.min.y;\n\n\tctx.beginPath();\n\tctx.rect(this.bounds.min.x-2, this.bounds.min.y-2, width+4, height+4);\n\tctx.strokeStyle = strokeStyle;\n\tctx.lineWidth = 2;\n\tctx.stroke();\n};\n\nLocation.prototype.get_random_position = function() {\n\tif(this.bounds){\n\t\treturn {\n\t\t\tx: getRandomArbitrary(this.bounds.min.x, this.bounds.max.x),\n\t\t\ty: getRandomArbitrary(this.bounds.min.y, this.bounds.max.y)\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tx: 0, \n\t\t\ty: 0\n\t\t}\n\t}\n};\n\nLocation.prototype.remove_agent =function(agent) {\n\tthis.occupants = this.occupants.filter(function(a) {\n\t\treturn (a !== agent)\n\t});\n\tagent.location = undefined;\n};\n\nLocation.prototype.set_bounds = function(bounds) {\n\tthis.bounds = bounds;\n};\n\nLocation.prototype.migrate_to = function(destination, agent, callback) {\n\tthis.remove_agent(agent);\n\tdestination.add_agent(agent);\n\n\tif(callback) {\n\t\tcallback(agent);\n\t}\n};\n\nLocation.prototype.try_getting_random_residents = function(num_to_get) {\n\tlet to_return = [];\n\tfor (let i=0; i<num_to_get; i++) {\n\t\tlet temp_a = getRandomChoice(this.occupants);\n\t\tif(temp_a && temp_a.migrating == false) {\n\t\t\tto_return.push(temp_a);\n\t\t}\n\t}\n\n\treturn to_return;\n\n}\n\nLocation.prototype.add_agent = function(agent) {\n\tthis.occupants.push(agent);\n\tagent.location = this;\n};\n\nmodule.exports = Location;","function Cohort() {\n\tthis.members = [];\n}\n\nCohort.prototype.move_cohort = function(destination, callback_for_agent) {\n\tfor (let i=0; i < this.members.length; i++) {\n\t\tlet agent = this.members[i];\n\t\tagent.location.migrate_to(destination, agent, callback_for_agent);\n\t}\n};\n\nCohort.prototype.send_cohort_home = function(callback_for_agent) {\n\tfor (let i=0; i < this.members.length; i++) {\n\t\tlet agent = this.members[i];\n\t\tagent.location.migrate_to(agent.home, agent, callback_for_agent)\n\t}\n};\n\nCohort.prototype.add_agent = function(agent, callback) {\n\tthis.members.push(agent);\n\tagent.cohorts.push(this);\n\t\n\tif (callback) callback(agent);\n};\n\nmodule.exports = Cohort;","let FastPriorityQueue = require('fastpriorityqueue');\nlet assert = require('assert');\n\n\nfunction EventQueue() {\n\tthis.fast_queue = new FastPriorityQueue(function(a,b) {\n\t\treturn a.time < b.time;\n\t});\n}\n\nEventQueue.prototype.add_event = function(cur_sim_time, q_event) {\n\tassert(q_event.time && q_event.callback);\n\tq_event.original_time = q_event.time;\n\tq_event.time += cur_sim_time;\n\tthis.fast_queue.add(q_event);\n};\n\nEventQueue.prototype.run_events_fired = function(cur_sim_time, event_limit) {\n\tlet num_events = 0;\n\twhile (this.fast_queue.peek() && this.fast_queue.peek().time < cur_sim_time && num_events < event_limit){\n\t\tvar this_event = this.fast_queue.poll();\n\t\tif (this_event.recurring) {\n\t\t\tthis.add_event(cur_sim_time, {time:this_event.original_time, callback:this_event.callback, recurring:true});\n\t\t}\n\t\tthis_event.callback();\n\t\tnum_events += 1;\n\t}\n};\n\nEventQueue.prototype.clear_events = function() {\n\tthis.fast_queue = null;\n\tthis.fast_queue = new FastPriorityQueue(function(a,b) {\n\t\treturn a.time < b.time;\n\t});\n};\n\n\n\nmodule.exports = EventQueue;","import { jStat } from 'jstat';\n\nvar uniqid = require(\"uniqid\");\n\n\n\nlet _mutate_random = function(other_agent) {\n\tlet new_color = other_agent.color_float + jStat.exponential.sample(8);\n\tlet new_contagiousness = other_agent.contagiousness \n\t//let new_contagiousness = Math.min(other_agent.contagiousness + jStat.normal.sample(0, 0.1), 1);\n\n\tnew_color = new_color % 1;\n\t//new_color = Math.random();\n\n\tthis.color_float = new_color;\n\tthis.contagiousness = new_contagiousness;\n}\n\nfunction Pathogen(color, parent, contagiousness) {\n\tconsole.log(\"new pathogen: \", contagiousness)\n\tthis.parent = undefined;\n\tthis.interaction_callback = undefined;\n\tthis.uuid = uniqid()  ;\n\tthis.color_float = color || Math.random();\n\tthis.mutation_function = _mutate_random;\n\tthis.contagiousness = contagiousness || 0.5;\n}\n\nPathogen.prototype.get_offspring = function(mut_rate) {\n\tlet offspring_color = this.color_float;\n\tlet new_pathogen = new Pathogen(offspring_color, this, this.contagiousness);\n\n\tif (Math.random() < mut_rate && this.mutation_function) {\n\t\tnew_pathogen.mutation_function(this);\n\t}\n\treturn new_pathogen;\n};\n\nexport default Pathogen;\n","import React, { useEffect, useRef, useLayoutEffect } from 'react';\nimport { Typography } from '@material-ui/core';\nimport Button from '@material-ui/core/Button';\nimport {InfectiousMatter, AgentStates, ContactGraph} from '../InfectiousMatter/simulation.js';\nconst Matter = require('matter-js');\nconst Viva = require('vivagraphjs');\n\n\nconst InfectiousMatterSimulation = ({InfectiousMatterRef, InfectiousMatterAPI, redraw_trigger, setWorldReadyTrigger, numMasked}) => {\n    const sim_div = useRef(null);\n\n    const setup_world = (num_to_mask) => {\n        let res_prop = {\n            type: \"residence\", \n            friction: 0.01,\n            bounds: {\n                min: {\n                    x: 20,\n                    y: 20,\n                },\n                max: {\n                    x: 380,\n                    y: 380,\n                }\n            }\n        };\n\n        let res_prop2 = {\n            type: \"residence\", \n            friction: 0.01,\n            bounds: {\n                min: {\n                    x: 410,\n                    y: 20,\n                },\n                max: {\n                    x: 780,\n                    y: 380,\n                }\n            }\n        };\n\n\n        let res1 = InfectiousMatterAPI(InfectiousMatterRef, {type:'add_location', payload:{residence_props: res_prop}});\n        let res2 = InfectiousMatterAPI(InfectiousMatterRef, {type:'add_location', payload:{residence_props: res_prop2}});\n\n        InfectiousMatterAPI(InfectiousMatterRef, {type:'add_agents', payload:{residence: res1, num_agents: 150}});\n        InfectiousMatterAPI(InfectiousMatterRef, {type:'add_agents', payload:{residence: res2, num_agents: 150}});\n\n        \n        \n        //shuffle the agents\n        Matter.Common.shuffle(InfectiousMatterRef.current.agents);\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'set_num_mask', payload: {num_masked: num_to_mask}});\n        console.log(num_to_mask);\n    };\n\n    useEffect(() => {\n\n        let world_params = {\n            num_residences: 1,\n            residence_options: [],\n            pop_size: 20,\n            num_to_infect: 2,\n            num_visitors: 0,\n            residence_size: 100,\n            residence_padding: 20\n        \n        };\n        \n        let simulation_params = {\n            sim_time_per_day: 1000,\n            agent_size: 4,\n            link_lifetime: 200,\n        };\n        simulation_params.link_lifetime = 7*simulation_params.sim_time_per_day;\n        \n        var infection_params = {\n            per_contact_infection: 0.5, \n\n            incubation_period_mu: 5,\n            incubation_period_sigma: 3,\n            \n            infectious_period_mu: 7,\n            infectious_period_sigma: 4,\n            fraction_asymptomatic: 0.2,\n            \n            asymptomatic_infectious_period_mu: 1.5,\n            asymptomatic_infectious_period_sigma: 1.5,\n        \n            fraction_seek_care: 0.5,\n            fraction_isolate: 0.2,\n            time_to_seek_care: 2.5,\n            movement_scale: 2.0,\n            use_pathogen_contagiousness: true,\n\n        };\n  \n        let default_simulation_colors = {\n            viva_colors: [0x9370DBff, 0x00FF00ff, 0xFFFF00ff, 0xFFA500ff, 0x0000FFff, 0xA9A9A9ff, 0xFF00FFff, 0x00CED1ff,0x98FB98ff, 0xCD853Fff],\n            matter_colors: [\"mediumpurple\", \"lime\", \"yellow\", \"orange\", \"blue\", \"darkgrey\", \"fuchsia\", \"darkturquoise\", \"palegreen\", \"peru\"]\n        }\n\n        \n        console.log('initalizing matter')\n\n        InfectiousMatterRef.current = new InfectiousMatter(false, simulation_params, infection_params, default_simulation_colors);\n        InfectiousMatterAPI(InfectiousMatterRef, {type:'setup_environment', payload:{sim_div:sim_div}});\n\n        setup_world(numMasked);\n        //InfectiousMatterAPI(InfectiousMatterRef, {type:'reset_simulator'});\n        \n    }, [])\n\n    //redraw simulation if we get the triggers\n    useLayoutEffect(()=> { \n        if(InfectiousMatterRef.current) {\n            setup_world(numMasked);\n            setWorldReadyTrigger( c => c+1);\n        }\n    }, [redraw_trigger])\n\n    return (\n        <div>\n            <div ref={sim_div} style={{height:400, width:800}}>\n\n            </div>\n        </div>\n        \n    );\n\n};\n\nexport default InfectiousMatterSimulation;\nexport {AgentStates, ContactGraph};\n","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,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\"","import { jStat } from 'jstat';\nimport Pathogen from './pathogen.js';\nimport InfectiousMatterSimulation from '../SimComponents/InfectiousMatterSimulation.js';\nimport * as myIcon from './icon.png'\nimport new_iconS from './new_S.png'\nimport  new_iconI from './new_I.png'\nimport  new_iconR from './new_R.png'\n\nimport * as iconPurple from './icon_purple.png'\nimport * as iconPurple_r from './icon_purple_r.png'\nimport * as iconPurple_i from './icon_purple_i.png'\nimport * as iconPurple_e from './icon_purple_e.png'\n\nimport * as iconOrange from './icon_orange.png'\nimport * as iconOrange_r from './icon_orange_r.png'\nimport * as iconOrange_i from './icon_orange_i.png'\nimport * as iconOrange_e from './icon_orange_e.png'\n\nimport * as iconGreen from './icon_green.png'\nimport * as iconGreen_r from './icon_green_r.png'\nimport * as iconGreen_i from './icon_green_i.png'\nimport * as iconGreen_e from './icon_green_e.png'\n\nimport * as iconYellow from './icon_yellow.png'\nimport * as iconYellow_r from './icon_yellow_r.png'\nimport * as iconYellow_i from './icon_yellow_i.png'\nimport * as iconYellow_e from './icon_yellow_e.png'\n\n\nvar Matter = require('matter-js');\nrequire('matter-wrap');\nvar { MatterCollisionEvents } = require('./MatterCollisionEvents.js');\nMatter.use('matter-wrap', MatterCollisionEvents);\n\nMatter._seed = 2;\nMath.random = Matter.Common.random;\njStat._random_fn = Matter.Common.random;\n\nvar assert = require('assert');\n// module aliases\nlet _Viva = require('vivagraphjs');\nvar ContactGraph = new _Viva.Graph.graph();\n\nvar Location = require('./location.js');\nvar Cohort = require('./cohort.js');\nvar EventQueue = require('./event_queue.js');\n\nvar Agent = require('./agent.js');\n\nlet colormap = require('colormap')\nlet colors = colormap( {\n    colormap: 'chlorophyll',\n    nshades: 9,\n    format: 'hex',\n    alpha: 1\n});\n\nlet pathogen_colors = colormap({\n    colormap: 'portland',\n    nshades: 15,\n    format: 'hex',\n    alpha: 1\n})\n\n\n\nlet interpolate = require('color-interpolate');\nlet pathogen_color_range = interpolate(['white']);\n\nvar AgentStates = {\n    SUSCEPTIBLE: 0,\n    EXPOSED: 1,\n    A_INFECTED: 2,\n    S_INFECTED: 3,\n    RECOVERED: 4,\n    size: 5\n};\n\nvar Engine = Matter.Engine;\nvar Render = Matter.Render;\nvar World = Matter.World;\nvar Body = Matter.Body;\nvar Bodies = Matter.Bodies;\nvar Bounds = Matter.Bounds;\nvar Mouse = Matter.Mouse;\nvar MouseConstraint = Matter.MouseConstraint;\nvar Events = Matter.Events;\nvar Render = Matter.Render;\n\nvar default_simulation_params = {\n    sim_time_per_day:2000,\n    agent_size: 3,\n    link_lifetime: 4000,\n    pathogen_mut_prob: 0.1\n};\n\nvar default_infection_params = {\n    per_contact_infection: 0.5, \n\n    incubation_period_mu: 5,\n    incubation_period_sigma: 3,\n    \n    infectious_period_mu: 7,\n    infectious_period_sigma: 4,\n    fraction_asymptomatic: 0.2,\n    \n    asymptomatic_infectious_period_mu: 1.5,\n    asymptomatic_infectious_period_sigma: 1.5,\n\n    fraction_seek_care: 0.5,\n    fraction_isolate: 0.2,\n    time_to_seek_care: 2.5,\n    movement_scale: 0.2,\n    use_pathogen_contagiousness: true,\n};\n\nvar default_simulation_colors = {\n    viva_colors: [0x8B008Bff, 0x00FF00ff, 0xFFFF00ff, 0xFFA500ff, 0x0000FFff, 0xA9A9A9ff, 0xFF00FFff, 0x00CED1ff,0x98FB98ff, 0xCD853Fff],\n    matter_colors: [\"darkmagenta\", \"lime\", \"yellow\", \"orange\", \"blue\", \"darkgrey\", \"fuchsia\", \"darkturquoise\", \"palegreen\", \"peru\"]\n}\n\nfunction InfectiousMatter(run_headless, simulation_params, infection_params, simulation_colors) {   \n    this.simulation_params = Matter.Common.extend(default_simulation_params, simulation_params);\n    this.infection_params = Matter.Common.extend(default_infection_params, infection_params);\n    this.simulation_colors = Matter.Common.extend(default_simulation_colors, simulation_colors);\n    this.matter_world = World.create() \n    this.headless = run_headless || false;\n    this.pathogen_color_range = pathogen_color_range;    \n\n    console.log(\"creating infectious matter environment!\");\n\n    this.matter_engine = Engine.create({\n      positionIterations: 15, \n      velocityIterations: 15,\n      constraintIterations: 10\n    });\n\n    this.matter_engine.world.gravity.y = 0.00;\n    this.event_queue = new EventQueue();\n    this.migration_graph = new _Viva.Graph.graph()\n\n\n}\n\nInfectiousMatter.prototype.setup_renderer = function(div_ref) {\n    let _div = div_ref;\n\n    this.matter_render = Render.create({\n        element: _div,\n        engine: this.matter_engine,\n        options: {\n            height: _div.offsetHeight,\n            width: _div.offsetWidth,\n            background: 'rgba(229,229,229)',\n            wireframes: false\n        }\n    });\n\n    var mouse = Mouse.create(this.matter_render.canvas);\n    \n    this.mouseConstraint = MouseConstraint.create(this.matter_engine, {\n        mouse: mouse,\n        constraint: {\n            stiffness: 0.1,\n            render: {\n                visible: true\n            }\n        }\n    });\n    \n    mouse.element.removeEventListener(\"mousewheel\", mouse.mousewheel);\n    mouse.element.removeEventListener(\"DOMMouseScroll\", mouse.mousewheel);\n    this.matter_render.mouse = mouse;  \n    World.add(this.matter_engine.world, this.mouseConstraint);\n    \n    Render.run(this.matter_render);\n    Engine.run(this.matter_engine);\n}\n\nInfectiousMatter.prototype.run_headless = function(timelimit) {\n\ttimelimit = timelimit || 30;\n\n\tif(this.run_headless) {\n        for(let t=0; t<timelimit*this.simulation_params.sim_time_per_day; t++) {\n\t\t\t//console.log(\"updating \" + this.cur_sim_time);\n\t\t\t//console.log(this.state_counts);\n\t        this.event_queue.run_events_fired(this.cur_sim_time, 500);\n\n            let temp_agent = Matter.Common.choose(this.agents);\n\n            //console.log(temp_agent.body.position);\n\n            Engine.update(this.matter_engine, 1000 / 60);\n            this.cur_sim_time = this.matter_engine.timing.timestamp;\n        }\n\t}\n}\n\n\nInfectiousMatter.prototype.setup_matter_env = function() {\n    ContactGraph.clear();\n    this.locations = [];\n    \n    this.migration_graph.clear();\n    this.location_uuid_hash = {};\n\n    this.agents = [];\n    this.cohorts = [];\n    this.cur_sim_time = 0;\n    this.state_counts = [];\n    this.matter_engine.timing.timestamp = 0;\n\n    for (let i=0; i<AgentStates.size; i++){\n        this.state_counts.push(0);\n    }\n\n   \n    \n    //Engine.run(this.matter_engine);\n    //Render.run(this.matter_render);\n\n    if(!this.headless) {\n\t    Events.on(this.matter_render, \"beforeRender\", (e) => {\n\t        this.cur_sim_time = e.timestamp;\n\t        this.event_queue.run_events_fired(this.cur_sim_time, 500);\n\t    });\n\n\t    Events.on(this.matter_render, \"afterRender\", (e) => {\n\t        let ctx = this.matter_render.context;\n\t        \n\t        if(ctx) {\n\t            //todo: refactor to callback\n\t            for (let i=0; i< this.locations.length; i++) {\n\t                this.locations[i].draw_borders(ctx);\n                } \n                this.agents.forEach( (agent) => {\n                    if(agent.masked){\n                        agent.draw_mask(ctx, this.simulation_params.agent_size);\n                    }\n                });\n\t        }\n\t    });\n    }\n\n    this.add_event({time: 100, callback: this.pulse_orgs_event(), recurring:true})\n\n\n};\n\nInfectiousMatter.prototype.update_org_state = function(org, new_state) {\n    let old_state = org.agent_object.state;\n    org.agent_object.state = new_state;\n\n    if( typeof old_state !== 'undefined') this.state_counts[old_state] -= 1;\n    \n    this.state_counts[new_state] += 1;\n\n    org.render.lineWidth = 10;\n    let stroke_color = org.render.strokeStyle;\n    let viva_node_color;\n    let img;\n    //todo: refactor to callback?\n    //refactor to event!\n    switch(new_state) {\n        case AgentStates.EXPOSED:\n            stroke_color = \"orange\";\n            img = \"e\"\n            org.render.sprite.texture = new_iconI;\n            break;\n        case AgentStates.S_INFECTED:\n            stroke_color = \"red\";\n            viva_node_color = 0xFF0000ff;\n            img = \"i\"\n            org.render.sprite.texture = new_iconI;\n            break;\n        case AgentStates.A_INFECTED:\n            stroke_color = \"red\";\n            viva_node_color = 0xFF0000ff;\n            img = \"i\"\n            org.render.sprite.texture = new_iconI;\n\n\n            break;\n        case AgentStates.RECOVERED:\n            stroke_color = \"blue\";\n            viva_node_color = 0xFFFFFFff;\n            img = \"r\"\n            org.render.sprite.texture = new_iconR;\n\n            break;\n        case AgentStates.SENSITIVE:\n            org.render.lineWidth = 0;\n            img = \"\"\n            org.render.sprite.texture = new_iconS;\n\n            break;\n        };\n\n    /*\n    if (org.agent_object.home.home_color ===\"lime\"){\n        if (img ===\"e\"){\n            org.render.sprite.texture = iconGreen_e\n        } else if (img ===\"i\"){\n            org.render.sprite.texture = iconGreen_i\n        } else if (img ===\"r\"){\n            org.render.sprite.texture = iconGreen_r\n        } else {\n            org.render.sprite.texture = iconGreen\n        }\n    } else if (org.agent_object.home.home_color ===\"mediumpurple\"){\n        if (img ===\"e\"){\n            org.render.sprite.texture = iconPurple_e\n        } else if (img ===\"i\"){\n            org.render.sprite.texture = iconPurple_i\n        } else if (img ===\"r\"){\n            org.render.sprite.texture = iconPurple_r\n        } else {\n            org.render.sprite.texture = iconPurple\n        }\n    } else if (org.agent_object.home.home_color ===\"yellow\"){\n        if (img ===\"e\"){\n            org.render.sprite.texture = iconYellow_e\n        } else if (img ===\"i\"){\n            org.render.sprite.texture = iconYellow_i\n        } else if (img ===\"r\"){\n            org.render.sprite.texture = iconYellow_r\n        } else {\n            org.render.sprite.texture = iconYellow\n        }\n    } else {\n        if (img ===\"e\"){\n            org.render.sprite.texture = iconOrange_e\n        } else if (img ===\"i\"){\n            org.render.sprite.texture = iconOrange_i\n        } else if (img ===\"r\"){\n            org.render.sprite.texture = iconOrange_r\n        } else {\n            org.render.sprite.texture = iconOrange\n        }\n    }\n    */\n\n    return org;\n    //viva_graphics.getNodeUI(org.agent_object.node.id).color = viva_node_color;\n};\n\nInfectiousMatter.prototype.add_location = function(name, location_properties) {\n    let new_location = new Location(name);\n    new_location.border_color = location_properties.border_color;\n    new_location.set_bounds(location_properties.bounds);\n    new_location.friction = location_properties.friction;\n    new_location.type = location_properties.type || 'none';\n\n    new_location.home_color = this.simulation_colors.matter_colors[this.locations.length];\n    new_location.viva_node_color = this.simulation_colors.viva_colors[this.locations.length];\n\n    this.locations.push(new_location);\n    this.location_uuid_hash[new_location.uuid] = new_location;\n    return new_location;\n};\n\nInfectiousMatter.prototype.add_cohort = function() {\n    let new_cohort = new Cohort();\n    this.cohorts.push(new_cohort);\n    return new_cohort;\n};\n\nInfectiousMatter.prototype.assign_cohort = function(org, cohort) {\n    cohort.add_agent(org.agent_object);\n};\n\nInfectiousMatter.prototype.expose_org = function(org, eventual_infected_state, infecting_agent, transmision_prob=0.5) {\n    if (infecting_agent && infecting_agent.pathogen){ \n        org.agent_object.pathogen = infecting_agent.pathogen.get_offspring(this.simulation_params.pathogen_mut_prob);\n    } else {\n        org.agent_object.pathogen = new Pathogen(0.5, 'root', transmision_prob);\n    }\n    this.update_org_state(org, AgentStates.S_INFECTED);\n    if (this.post_infection_callback) this.post_infection_callback(org.agent_object, infecting_agent);\n\n\n    this.add_event( {\n\n        time: Math.max(jStat.normal.sample(this.infection_params.incubation_period_mu, this.infection_params.incubation_period_sigma), 1)*this.simulation_params.sim_time_per_day,\n        callback: () => {\n            this.update_org_state(org, eventual_infected_state);\n            let days_to_recover = 0;\n            if (eventual_infected_state == AgentStates.A_INFECTED) {\n                //\n                days_to_recover = Math.max(jStat.normal.sample(this.infection_params.asymptomatic_infectious_period_mu, this.infection_params.asymptomatic_infectious_period_sigma), 0.5);\n            } else {\n                //we're symtomatic!\n                days_to_recover = Math.max(jStat.normal.sample(this.infection_params.infectious_period_mu, this.infection_params.infectious_period_sigma), 4);\n            }\n\n            this.add_event( {\n                time: days_to_recover*this.simulation_params.sim_time_per_day,\n                callback: () => {\n                    this.update_org_state(org, AgentStates.RECOVERED)\n                }\n            });\n        }\n    });\n\n\n}\nInfectiousMatter.prototype.register_infection_callback = function(callback) {\n    this.post_infection_callback = callback;\n}\n\nInfectiousMatter.prototype._check_edge_for_removal = function(edge) {\n    return () => {\n        if (edge.data.timestamp < this.cur_sim_time - this.simulation_params.link_lifetime) {\n            ContactGraph.removeLink(edge);\n        } \n        else {\n            this.add_event( {\n                time:(this.cur_sim_time + this.simulation_params.link_lifetime) - edge.data.timestamp,\n                callback: this._check_edge_for_removal(edge)\n            }); \n        }\n    };\n};\n\nInfectiousMatter.prototype.calc_prob_infection = function(agent_a_body, agent_b_body) {\n\n    return this.infection_params.per_contact_infection;\n}\n\nInfectiousMatter.prototype._default_interaction_callback  = function(this_agent_body) {\n    return (\n        (other_agent) => {\n            if ((other_agent.state == AgentStates.S_INFECTED ||\n                other_agent.state == AgentStates.A_INFECTED) && \n                this_agent_body.agent_object.state == AgentStates.SUSCEPTIBLE) {\n\n                if (Matter.Common.random(0, 1) < this.calc_prob_infection(this_agent_body, other_agent.body)) {\n                    //we're going to infect this org so \n                    //now we have to pick which state...\n                    let future_state;\n                    if (Matter.Common.random(0,1) < this.infection_params.fraction_asymptomatic) {\n                        future_state = AgentStates.A_INFECTED;\n                    } else {\n                        future_state = AgentStates.S_INFECTED;\n                    }\n\n                    this.expose_org(this_agent_body, future_state, other_agent);\n                    //this.`post_infection_callback`(this_agent.agent_object, other_agent);\n                }\n            }\n            assert(other_agent.uuid && this_agent_body.agent_object.uuid)\n\n            var this_edge = ContactGraph.hasLink(this_agent_body.agent_object.uuid, other_agent.uuid) || ContactGraph.hasLink(other_agent.uuid, this_agent_body.agent_object.uuid);\n            if (this_edge){\n                this_edge.data.timestamp = this.cur_sim_time;\n            } else {\n                assert(ContactGraph.hasNode(this_agent_body.agent_object.uuid) && ContactGraph.hasNode(this_agent_body.agent_object.uuid));\n                this_edge = ContactGraph.addLink(this_agent_body.agent_object.uuid, other_agent.uuid, {origin:this_agent_body.agent_object.uuid, timestamp:this.cur_sim_time});\n                this.add_event( {\n                    time: this.simulation_params.link_lifetime+1, \n                    callback: this._check_edge_for_removal(this_edge)\n                });\n            }\n\n        }\n    );\n};\n\nInfectiousMatter.prototype.add_agent = function(home_location, agent_state=AgentStates.SUSCEPTIBLE) {\n\n    assert(home_location && home_location.get_random_position);\n\n    let loc = home_location.get_random_position();\n    //if home location color is...\n    let colorIcon= new_iconS\n\n    let new_agent_body = Bodies.circle(loc.x, loc.y, this.simulation_params.agent_size, {\n        render: {sprite: {texture: colorIcon, xScale: 0.15,\n        yScale: 0.15}},\n        plugin: {wrap: home_location.bounds}, \n        \n    });\n    Matter.Body.setInertia(new_agent_body, Infinity);\n    // new_agent_body.render.fillStyle = home_location.home_color || \"black\";\n    // new_agent_body.strokeStyle = \"black\";\n    // new_agent_body.lineWidth = 2;\n\n    new_agent_body.agent_object = new Agent(new_agent_body);\n    new_agent_body.frictionAir = home_location.friction;\n    new_agent_body.friction = 0;\n    new_agent_body.restitution = 1.1;\n    new_agent_body.node = ContactGraph.addNode(new_agent_body.agent_object.uuid, {something:true});\n    new_agent_body.agent_object.home = home_location;\n    new_agent_body.agent_object.viva_color = home_location.viva_node_color\n    \n    home_location.add_agent(new_agent_body.agent_object);\n\n    new_agent_body.agent_object.register_interaction_callback(this._default_interaction_callback(new_agent_body, this.get_prob_of_infection));\n\n\n    new_agent_body.onCollide( (pair) => {\n        if (pair.bodyA === new_agent_body && pair.bodyB.agent_object) {\n            pair.bodyA.agent_object.handle_agent_contact(pair.bodyB.agent_object);\n\n        } else if (pair.bodyB === new_agent_body && pair.bodyA.agent_object) {\n            pair.bodyB.agent_object.handle_agent_contact(pair.bodyA.agent_object)\n        }\n    });\n\n    World.add(this.matter_engine.world, new_agent_body);\n    this.agents.push(new_agent_body.agent_object);\n    this.update_org_state(new_agent_body, agent_state);\n    \n    return(new_agent_body);\n};\n\nInfectiousMatter.prototype.add_event = function (q_item) {\n    assert(q_item.time && q_item.callback);\n    this.event_queue.add_event(this.cur_sim_time, q_item);\n};\n\nInfectiousMatter.prototype.set_agent_contact_callback = function (callback) {\n    this.agent_contact_callback = callback;\n};\n\nInfectiousMatter.prototype.clear_simulator = function() {\n    //Render.stop(this.matter_render);\n    World.clear(this.matter_engine.world);\n    Engine.clear(this.matter_engine);\n    this.event_queue.clear_events();\n}\n\nInfectiousMatter.prototype.remove_simulator = function() {\n    this.clear_simulator();\n    Render.stop();\n\n    this.matter_engine.events = {};\n    this.matter_render.canvas.remove();\n    this.matter_render.canvas = null;\n    this.matter_render.context = null;\n    this.matter_render.textures = {};\n\n    this.matter_world = null;\n    this.matter_engine = null;\n    this.event_queue = null;\n    this.matter_render = null;\n    this.mouseConstraint = null;\n}\n\nInfectiousMatter.prototype.pulse_orgs_event = function() {\n    return () => {\n        if (this.agents.length > 0) {\n            for (let i=0; i < 100; i++) {\n                let temp_agent = Matter.Common.choose(this.agents);\n                Matter.Body.applyForce(temp_agent.body, temp_agent.body.position, {\n                    x:Matter.Common.random(-2e-5*this.infection_params.movement_scale, 2e-5*this.infection_params.movement_scale),\n                    y:Matter.Common.random(-2e-5*this.infection_params.movement_scale, 2e-5*this.infection_params.movement_scale)\n                });\n            }\n        }\n    };\n};\n\nInfectiousMatter.prototype.get_migration_links = function() {\n    let to_return = []\n    this.migration_graph.forEachLink(function(link) {\n        to_return.push({from_uuid:link.fromId, to_uuid:link.toId, num_agents:link.data.num_agents});\n    });\n    return to_return;\n}\nInfectiousMatter.prototype.add_migration_link = function(from_location_uuid, to_location_uuid, num_agents_per_day) {\n    var existing_edge = this.migration_graph.hasLink(from_location_uuid, to_location_uuid);\n    if(existing_edge) {\n        existing_edge.data.num_agents = num_agents_per_day;\n    } else {\n        this.migration_graph.addLink(from_location_uuid, to_location_uuid, {num_agents:num_agents_per_day});\n    }\n};\nInfectiousMatter.prototype.remove_migration_link = function(from_location_uuid, to_location_uuid) {\n    var existing_edge = this.migration_graph.hasLink(from_location_uuid, to_location_uuid);\n    if (existing_edge) {\n        this.migration_graph.removeLink(existing_edge);\n    }\n};\n\n\nInfectiousMatter.prototype.new_migration_event = function() {\n    return () => {\n        this.migration_graph.forEachLink((link) => {\n            let source = this.location_uuid_hash[link.fromId];\n            let dest = this.location_uuid_hash[link.toId];\n\n            let to_migrate = source.try_getting_random_residents(link.data.num_agents);\n            to_migrate.forEach( migrating_agent => {\n                migrating_agent.home_state = {\n                    location:source, \n                    position: {...migrating_agent.body.position}, \n                    velocity: {...migrating_agent.body.velocity}\n                };\n\n                source.migrate_to(dest, migrating_agent, function(agent) {\n                    agent.body.plugin.wrap = dest.bounds;\n                    Matter.Body.setPosition(agent.body, dest.get_random_position());\n                    agent.body.frictionAir = dest.friction;\n                    agent.migrating = true;\n                });\n\n                this.add_event( {\n                    time: this.simulation_params.sim_time_per_day,\n                    callback: () => {\n                        dest.migrate_to(source, migrating_agent, (agent) => {\n                            Matter.Body.setPosition(agent.body, migrating_agent.home_state.position);\n                            agent.body.plugin.wrap = source.bounds;\n                            Matter.Body.setVelocity(agent.body, migrating_agent.home_state.velocity);\n                            agent.body.frictionAir = source.friction;\n                            agent.migrating = false;\n                        })\n                    }\n                })\n            } )\n\n            //TODO: check if this link still makes sense, if not we should remove it...\n        })\n    }\n};\n\nexport { InfectiousMatter, AgentStates, ContactGraph };\n","export default \"data:image/png;base64,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\"","import React, {useEffect, useState, useReducer, useRef, useLayoutEffect} from 'react';\nimport {AgentStates, ContactGraph} from '../InfectiousMatter/simulation.js';\nimport Agent from '../InfectiousMatter/agent.js';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Viva from 'vivagraphjs';\n\nlet viva_layout = Viva.Graph.Layout.forceDirected(ContactGraph, {\n    springLength : 15,\n    springCoeff : 0.00005,\n    dragCoeff : 0.01,\n    gravity : -1.5\n});\n\nlet viva_graphics = Viva.Graph.View.webglGraphics();\n\n\nconst InfectiousMatterContactGraph = ({InfectiousMatterRef, InfectiousMatterAPI, worldReadyTrigger}) => {\n    const graph_div = useRef(null);\n\n    useEffect( ()=> {\n        console.log(\"initalizing viva graph\");\n        let viva_renderer = Viva.Graph.View.renderer(ContactGraph, {\n            container: graph_div.current,\n            graphics: viva_graphics,\n            renderLinks: true,\n            layout: viva_layout,\n            interactive: 'node drag'\n    \n        });\n        viva_renderer.run();\n        for (let i=0; i < 30; i++) {\n            viva_renderer.zoomOut();\n        }\n    }, []);\n\n    useEffect ( () => {\n        const color_agent = (agent) => {\n            viva_graphics.getNodeUI(agent.uuid).color = agent.viva_color;\n            viva_graphics.getNodeUI(agent.uuid).size = 40;\n        }\n\n        InfectiousMatterAPI(InfectiousMatterRef, {type: 'forEach_agents', payload:{callback:color_agent}})\n    }, [worldReadyTrigger])\n\n    return (\n        <div ref={graph_div} style={{width:400, height:400}} >\n        </div>\n    );\n};\n\nexport default InfectiousMatterContactGraph;\n","import React, {useEffect, useState, useReducer, useLayoutEffect} from 'react';\nimport Plot from 'react-plotly.js'; //TODO: use bundles to limit the size of this app\nimport {AgentStates} from '../InfectiousMatter/simulation.js';\n\nlet get_fresh_traces = function() {\n  let exposed = {\n      x: [0],\n      y: [0],\n      stackgroup: 'one',\n      //type: \"scattergl\",\n      name: \"Exposed\",\n    marker: { color: \"orange\" }\n  };\n\n  let infected = {\n    x: [0],\n    y: [0],\n    stackgroup: 'one',\n    //type: \"scattergl\",\n    name: \"Infected\",\n    marker: { color: \"red\" }\n  };\n\n  let recovered = {\n    x: [0],\n    y: [0],\n    stackgroup: 'one',\n    name: \"Recovered\",\n    //type: \"scattergl\",\n    marker: { color: \"green\" }\n  };\n\n  let susceptible = {\n      x: [0],\n      y: [0],\n      stackgroup: 'one',\n      name: \"Susceptible\",\n      //type: \"scattergl\",\n      marker: { color: \"grey\" }\n  }\n  let plot_data = [exposed, infected, recovered, susceptible];\n  return plot_data;\n}\n\nlet infection_layout = {\n  margin: {\n      l: 50,\n      r: 10,\n      b: 50,\n      t: 10,\n      pad: 10\n    },\n  showlegend: true,\n  legend: {\n      x:1,\n      xanchor: 'right',\n      y:1\n  }, \n  xaxis: {\n      title: \"Days\",\n      rangemode: 'nonnegative'\n  }, \n  yaxis: {\n      title: \"Count\",\n      rangemode: 'nonnegative'\n  },\n  width:390,\n  height:390\n};\n\nconst initial_traces = get_fresh_traces();\n\nfunction reducer(state, action) {\n  if (!state) { console.log('didnt get state');}\n  let new_state = [...state];\n  switch (action.type) {\n    case 'extend': {\n      new_state[0].x.push(action.payload.cur_time);\n      new_state[0].y.push(action.payload.cur_state_counts[AgentStates.EXPOSED]);\n\n      new_state[1].x.push(action.payload.cur_time);\n      new_state[1].y.push(action.payload.cur_state_counts[AgentStates.S_INFECTED] + action.payload.cur_state_counts[AgentStates.A_INFECTED]);\n\n      new_state[2].x.push(action.payload.cur_time);\n      new_state[2].y.push(action.payload.cur_state_counts[AgentStates.RECOVERED]);\n\n      new_state[3].x.push(action.payload.cur_time);\n      new_state[3].y.push(action.payload.cur_state_counts[AgentStates.SUSCEPTIBLE]);\n\n      // new_state[1].push(action.payload.state_counts[AgentStates.S_INFECTED] + action.state_counts[AgentStates.A_INFECTED]);\n      // new_state[2].push(action.payload.state_counts[AgentStates.RECOVERED]);\n      // new_state[3].push(action.payload.state_counts[AgentStates.SUSCEPTIBLE]);\n      return new_state;\n    }\n    case 'reset': {\n        new_state = get_fresh_traces();\n        return new_state;\n    }\n    default: {\n\n    }\n  }\n}\n\nconst InfectiousMatterPlot = ({InfectiousMatterRef, InfectiousMatterAPI, redraw_trigger}) => {\n\n  const [plotTraces, dispatchTraces] = useReducer(reducer, initial_traces);\n  const [plotRevision, setPlotRevision] = useState(0);\n  let plot_data = get_fresh_traces();\n  let plot_layout = infection_layout;\n\n  useEffect( () => {\n    const update_traces = () => {\n        let api_return = InfectiousMatterAPI(InfectiousMatterRef, {type:'get_state_counts'});\n        dispatchTraces({type: 'extend', payload:{cur_time: api_return.cur_time, cur_state_counts: api_return.state_counts}});\n        setPlotRevision(p => p+1);\n      };\n\n    const interval = setInterval( ()=> {\n      update_traces();\n    }, 600);\n    return () => { clearInterval(interval);};\n  }, [redraw_trigger])\n\n  //redraw plot if we get the triggers\n  useLayoutEffect(()=> { \n    if(InfectiousMatterRef.current) {\n        dispatchTraces({type:'reset'});\n        setPlotRevision(p => p+1);\n    }\n  }, [redraw_trigger])\n\n  return (\n    <Plot\n      data={plotTraces}\n      layout={{...plot_layout, datarevision:plotRevision}}\n    />\n  );\n};\n\nexport default InfectiousMatterPlot;\n","import React, {useRef, useEffect, useReducer, useState, useLayoutEffect} from 'react';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport Typography from '@material-ui/core/Typography';\nimport { InfectiousMatter} from '../InfectiousMatter/simulation.js';\nimport InfectiousMatterSimulation, {AgentStates, ContactGraph} from './InfectiousMatterSimulation.js';\nimport InfectiousMatterContactGraph from './InfectiousMatterContactGraph.js';\nimport InfectiousMatterMigrationTable from './InfectiousMatterMigrationTable';\nimport InfectiousMatterPlot from './InfectiousMatterPlot.js';\nimport Matter from 'matter-js';\nimport Slider from '@material-ui/core/Slider';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListSubheader from '@material-ui/core/ListSubheader';\nimport MaterialTable from 'material-table';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 0,\n    minWidth:1200\n  },\n  controlls: {\n    width:600,\n  },\n  paper: {\n    minHeight: 400,\n    minWidth: 400,\n    textAlign: 'center',\n  },\n  paperControlls: {\n    minHeight: 400,\n    minWidth: 400,\n    textAlign: 'center',  \n    padding: theme.spacing(2)\n  }\n}));\n\nInfectiousMatter.prototype.mask_transmission_props = { self_protection:0.05, others_protection:0.5};\n\n//agent_a is always a susceptable exposed to an infected (agent_b)\n/* InfectiousMatter.prototype.calc_prob_infection = function(agent_a_body, agent_b_body) {\n  console.log(\"actually I'm here.\")\n  let default_infection_prob = this.infection_params.per_contact_infection;\n  if(agent_a_body.agent_object.masked && agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.self_protection) * (1-this.mask_transmission_props.others_protection);\n  else if (agent_a_body.agent_object.masked &&! agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.self_protection);\n  else if (!agent_a_body.agent_object.masked && agent_b_body.agent_object.masked)\n      return default_infection_prob * (1-this.mask_transmission_props.others_protection);\n  else if (!agent_a_body.agent_object.masked &&! agent_b_body.agent_object.masked)\n      return default_infection_prob;\n} */\nInfectiousMatter.prototype.calc_prob_infection = function(agent_a_body, agent_b_body) {\n  //agent_a is always a susceptable exposed to an infected (agent_b)\n  //use pathogen object's transmission probability here...\n  //mutate it here? \n  if (this.infection_params.use_pathogen_contagiousness) {\n    return agent_b_body.agent_object.pathogen.contagiousness\n  } else {\n    return this.infection_params.per_contact_infection;\n  }\n}\n\nconst InfectiousMatterAPI = (InfectiousMatterRef, action) => {\n  if (action.type == 'setup_environment') {\n    InfectiousMatterRef.current.setup_renderer(action.payload.sim_div.current);\n    InfectiousMatterRef.current.setup_matter_env();\n  }\n  if (action.type == 'update_mask_transmission_params') {\n    if(action.payload.self_protection) {\n      InfectiousMatterRef.current.mask_transmission_props.self_protection = action.payload.self_protection;\n    }\n    if(action.payload.others_protection) {\n      InfectiousMatterRef.current.mask_transmission_props.others_protection = action.payload.others_protection;\n    }\n  }\n  if (action.type == 'update_movement_scale') {\n    if(action.payload.movement_scale) {\n      InfectiousMatterRef.current.infection_params.movement_scale = action.payload.movement_scale;\n    }\n  }\n  if (action.type == 'reset_simulator') {\n    InfectiousMatterRef.current.clear_simulator();\n    InfectiousMatterRef.current.setup_matter_env();\n  }\n  if (action.type == 'add_location') {\n    let res = InfectiousMatterRef.current.add_location('residence', action.payload.residence_props)\n    return res;\n  }\n  if (action.type == 'add_agents') {\n    let new_agent = null;\n    if (action.payload.residence && action.payload.num_agents) {\n      for (let i=0; i< action.payload.num_agents; i++) {\n        new_agent = InfectiousMatterRef.current.add_agent(action.payload.residence)\n      }\n    }\n    if (action.payload.callback && new_agent) {\n      action.payload.callback(new_agent.agent_object); \n    }\n  }\n  if (action.type == 'map_agents') {\n    return InfectiousMatterRef.current.agents.map( (agent, agent_id) => action.payload.callback(agent, agent_id));\n  }\n  if (action.type == 'forEach_agents') {\n    InfectiousMatterRef.current.agents.forEach( (agent) => action.payload.callback(agent));\n  }\n  if (action.type == 'map_locations') {\n    return InfectiousMatterRef.current.locations.map( (loc, loc_idx) => action.payload.callback(loc, loc_idx));\n  }\n  if (action.type == 'forEach_location') {\n    InfectiousMatterRef.current.locations.forEach( (loc) => action.payload.callback(loc));\n  }\n  if (action.type == 'infect_random_agents') {\n    if(action.payload.num_agents) {\n      for(let i=0; i< action.payload.num_agents; i++) {\n        let random_agent = Matter.Common.choose(InfectiousMatterRef.current.agents);\n        InfectiousMatterRef.current.expose_org(random_agent.body, AgentStates.S_INFECTED);\n      }\n    }\n  } \n  if (action.type == 'infect_each_location') {\n    if(action.payload.num_agents && action.payload.infection_probs) {\n      InfectiousMatterRef.current.locations.forEach( (loc, loc_idx) => {\n        let agents_to_infect = loc.try_getting_random_residents(action.payload.num_agents)\n        agents_to_infect.forEach( (random_agent) => {\n          console.log(action.payload.infection_probs[loc_idx]);\n          InfectiousMatterRef.current.expose_org(random_agent.body, AgentStates.S_INFECTED, null, action.payload.infection_probs[loc_idx])\n        })\n      });\n    }\n  }\n  if (action.type == 'get_migration_links') {\n    return InfectiousMatterRef.current.get_migration_links();\n  }\n  if (action.type == 'add_migration_link') {\n    InfectiousMatterRef.current.add_migration_link(action.payload.from_location, action.payload.to_location, action.payload.num_agents)\n  }\n  if (action.type == 'clear_migration_links') {\n    InfectiousMatterRef.current.migration_graph.clear();\n  }\n  if (action.type == 'remove_migration_link') {\n    InfectiousMatterRef.current.remove_migration_link(action.payload.from_location, action.payload.to_location)\n  }\n  if (action.type == 'get_state_counts') {\n    return {state_counts: InfectiousMatterRef.current.state_counts, cur_time: InfectiousMatterRef.current.cur_sim_time/ InfectiousMatterRef.current.simulation_params.sim_time_per_day};\n  }\n  if (action.type == 'set_num_mask') {\n    // get current num of people masked\n    let masked_list=[];\n    let unmasked_list=[];\n    InfectiousMatterRef.current.agents.forEach( (agent) => {\n      if(agent.masked){\n        masked_list.push(agent);\n      }\n      else{\n        unmasked_list.push(agent);\n      }\n    });\n\n    let cur_num_masked = masked_list.length;\n    let num_needing_masks = action.payload.num_masked - cur_num_masked;\n    if (num_needing_masks > 0) {\n      for(let i=0; i< num_needing_masks; i++) {\n        unmasked_list[i].masked = true;\n      }\n    } else if (num_needing_masks < 0) {\n      for(let i=0; i<-num_needing_masks; i++) {\n        masked_list[i].masked = false;\n      }\n    }\n    /*\n    if (num_needing_masks > 0){\n      for (let i=0; i < num_needing_masks; i++){\n        let agent_to_mask = Matter.Common.choose(unmasked_list);\n        if (agent_to_mask.masked == false){\n          agent_to_mask.masked = true;\n        }\n      }\n    }\n    else if(num_needing_masks < 0){\n      for (let i=0; i < -num_needing_masks; i++){\n        let agent_to_unmask = Matter.Common.choose(masked_list);\n        if (agent_to_unmask) {\n          agent_to_unmask.masked=false;\n        }\n      }\n    }\n    */\n  }\n};\n\n\n\nconst InfectiousMatterContainer = (props) => {\n  const classes = useStyles();\n  const InfectiousMatterRef = useRef(null);\n  const [numMasked, setNumMasked] = useState(0);\n  const [maskSelfProtection, setMaskSelfProtection] = useState(0.05);\n  const [maskOthersProtection, setMaskOthersProtection] = useState(0.5);\n  const [movementScale, setMovementScale] = useState(3.0);\n  \n  const [redraw_trigger, setRedrawTrigger] = useState(0);\n  const [worldReadyTrigger, setWorldReadyTrigger] = useState(0);\n\n  const resetSimulation = (e) => {\n    InfectiousMatterAPI(InfectiousMatterRef, {type: 'reset_simulator'});\n    setRedrawTrigger(c=>c+1);\n  }\n  const infectAgent = (e) => {\n    InfectiousMatterAPI(\n      InfectiousMatterRef, \n      {\n        type: 'infect_each_location', \n        payload: {\n          num_agents: 2,\n          infection_probs: [0.9, 0.3]\n        }\n      });\n  }\n\n  function handleNumMaskedSliderChange(event, newValue){\n    setNumMasked(newValue);\n  }\n  function handleMaskSelfProtectionChange(event, newValue) {\n    setMaskSelfProtection(newValue);\n  }\n  function handleMaskOthersProtectionChange(event, newValue) {\n    setMaskOthersProtection(newValue);\n  }\n  function handleMovementScaleChange(event, newValue) {\n    setMovementScale(newValue);\n  }\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_mask_transmission_params', payload: {self_protection: maskSelfProtection}});\n  }, [maskSelfProtection])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_mask_transmission_params', payload: {others_protection: maskOthersProtection}});\n  }, [maskOthersProtection])\n\n  useEffect( () => {\n    InfectiousMatterAPI (\n      InfectiousMatterRef, \n      {type: 'update_movement_scale', payload: {movement_scale: movementScale}});\n  }, [movementScale])\n\n  useEffect( () => {\n    InfectiousMatterAPI(InfectiousMatterRef, {type: 'set_num_mask', payload: {num_masked: numMasked}});\n  }, [numMasked]);\n\n  return (\n    <div className=\"App\">\n      <Grid container direction=\"row\" justify=\"center\" alignItems=\"center\" className={classes.root} spacing={3}>\n        <Grid item>\n        <Card className={classes.paper}>\n          <InfectiousMatterSimulation \n            InfectiousMatterRef={InfectiousMatterRef}\n            InfectiousMatterAPI={InfectiousMatterAPI}\n            redraw_trigger={redraw_trigger}\n            setWorldReadyTrigger={setWorldReadyTrigger}\n            numMasked={numMasked}\n          />\n        </Card>\n        </Grid>\n\n      </Grid>\n\n      <Grid container direction=\"row\" justify=\"center\" alignItems=\"center\" className={classes.root} spacing={10}>\n        <Grid item alignItems=\"flex-start\">\n        <Card className={classes.paper}>\n          <List>\n          <ListSubheader disableSticky={true}>World Settings</ListSubheader>\n          <ListItem>\n            <ListItemText id=\"Movement\" primary=\"Movement Scale\" />\n            <Slider\n              value={movementScale}\n              aria-labelledby=\"discrete-slider\"\n              valueLabelDisplay=\"on\"\n              onChange={handleMovementScaleChange}\n              step={0.25}\n              min={0}\n              max={10}\n            />\n          </ListItem>\n          <ListItem>\n            <Grid container direction=\"row\" spacing={3}>\n              <Grid item>\n                <Button variant=\"contained\" onClick={resetSimulation}>Reset</Button>\n              </Grid>\n              <Grid item>\n                <Button variant=\"contained\" onClick={infectAgent}>\n                  Infect Random Agent\n                </Button>\n              </Grid>\n            </Grid>\n          </ListItem>          \n\n        </List>\n        </Card>\n        </Grid>\n    </Grid>\n    </div>\n  )\n}\n\nexport default InfectiousMatterContainer;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport InfectiousMatterContainer from './SimComponents/InfectiousMatterContainer.js';\n\nReactDOM.render(\n  <React.StrictMode>\n    <InfectiousMatterContainer />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}